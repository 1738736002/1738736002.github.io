<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.1.1"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1.0.2/themes/blue/pace-theme-fill-left.css"><script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"example.com",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!0,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!0,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="nodeJs的基础知识点"><meta property="og:type" content="article"><meta property="og:title" content="前端必学之nodeJs"><meta property="og:url" content="http://example.com/2020/09/10/8.node/index.html"><meta property="og:site_name" content="boke"><meta property="og:description" content="nodeJs的基础知识点"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="c:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20200729181121523.png"><meta property="og:image" content="c:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20200729181209875.png"><meta property="og:image" content="c:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20200816105004618.png"><meta property="og:image" content="c:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20200613170655276.png"><meta property="og:image" content="c:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20200613171409575.png"><meta property="og:image" content="c:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20200613171546347.png"><meta property="og:image" content="c:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20200614104017778.png"><meta property="og:image" content="c:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20200817111232641.png"><meta property="og:image" content="c:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20200817112247843.png"><meta property="og:image" content="c:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20200817113612376.png"><meta property="og:image" content="c:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20200817114558756.png"><meta property="og:image" content="c:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20200606110014073.png"><meta property="article:published_time" content="2020-09-10T07:46:35.000Z"><meta property="article:modified_time" content="2020-09-21T02:44:40.883Z"><meta property="article:author" content="John Doe"><meta property="article:tag" content="nodeJs"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="c:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20200729181121523.png"><link rel="canonical" href="http://example.com/2020/09/10/8.node/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>前端必学之nodeJs | boke</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="boke" type="application/atom+xml">
</head><body itemscope itemtype="http://schema.org/WebPage"><script color="0,0,0" opacity="0.8" zindex="-2" count="200" type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">boke</h1><span class="logo-line-after"><i></i></span></a></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-schedule"><a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a></li><li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益 404</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://example.com/2020/09/10/8.node/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=3684345252,2646729991&fm=26&gp=0.jpg"><meta itemprop="name" content="John Doe"><meta itemprop="description" content=""></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="boke"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">前端必学之nodeJs</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2020-09-10 15:46:35" itemprop="dateCreated datePublished" datetime="2020-09-10T15:46:35+08:00">2020-09-10</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-09-21 10:44:40" itemprop="dateModified" datetime="2020-09-21T10:44:40+08:00">2020-09-21</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/node/" itemprop="url" rel="index"><span itemprop="name">node</span></a> </span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span id="busuanzi_value_page_pv"></span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Valine：</span> <a title="valine" href="/2020/09/10/8.node/#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2020/09/10/8.node/" itemprop="commentCount"></span></a></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>44k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>40 分钟</span></span><div class="post-description">nodeJs的基础知识点</div></div></header><div class="post-body" itemprop="articleBody"><h1 id="node-js"><a href="#node-js" class="headerlink" title="node.js"></a>node.js</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><h3 id="1-Node-js是什么"><a href="#1-Node-js是什么" class="headerlink" title="1.Node.js是什么"></a>1.Node.js是什么</h3><ul><li>node.js他是JavaScript的一个运行环境</li><li>他既不是语言，也不是框架，他是一个平台<a id="more"></a></li></ul><h3 id="2-Node-js中的javascript"><a href="#2-Node-js中的javascript" class="headerlink" title="2.Node.js中的javascript"></a>2.Node.js中的javascript</h3><blockquote><p>node js对象中没有DOM，BOM对象。有一大堆专供对象</p><p>两者都有：数值/布尔/原始类型。ES对象：String,Math,Regex,…</p></blockquote><table><thead><tr><th><strong>前端JS中的数据类型：</strong> 1.基本/原生/值类型 string、number、boolean、null、undefined 2.引用/对象类型 ES对象类型：String、Number、Boolean、Math、Date、RegExp、Object、Function、Error…. BOM对象类型：window、document、screen、history、location、navigator、event… DOM对象类型：Node、Element、Attr…. 用户自定义对象类型： { }</th></tr></thead><tbody><tr><td><strong>后端Node.js中的数据类型：</strong> 1. 基本/原生/值类型 string、number、boolean、null、undefined 2. 引用/对象类型 ES对象类型：String、Number、Boolean、Math、Date、RegExp、Object、Function、Error…. Node.js特供对象：目前有几百个…. 用户自定义对象类型： { }</td></tr></tbody></table><h3 id="3-模块"><a href="#3-模块" class="headerlink" title="3.模块"></a>3.模块</h3><p><strong>模块的种类</strong></p><ul><li>内置模块 （node.js内置模块）</li><li>第三方模块</li><li>自定义模块</li></ul><p><strong>模块系统</strong></p><ul><li>在 Node 中没有全局作用域的概念</li><li>在 Node 中，只能通过 require 方法来加载执行多个 JavaScript 脚本文件</li><li>require 加载只能是执行其中的代码，文件与文件之间由于是模块作用域，所以不会有污染的问题<ul><li>模块完全是封闭的</li><li>外部无法访问内部</li><li>内部也无法访问外部</li></ul></li><li>模块作用域固然带来了一些好处<ul><li>可以加载执行多个文件</li><li>可以完全避免变量命名冲突污染的问题</li></ul></li><li>在某些情况下，模块与模块是需要进行通信的</li><li>在每个模块中，都提供了一个对象：<code>exports</code><ul><li>该对象默认是一个空对象</li><li>你要做的就是把需要被外部访问使用的成员手动的挂载到 <code>exports</code> 接口对象中。</li><li>然后谁来 <code>require</code> 这个模块，谁就可以得到模块内部的 <code>exports</code> 接口对象。</li></ul></li></ul><p><strong>核心模块</strong></p><ul><li>核心模块是由 Node 提供的一个个的具名的模块，它们都有自己特殊的名称标识<ul><li>fs 文件操作模块</li><li>http 网络服务构建模块</li><li>os 操作系统信息模块</li><li>path 路径处理模块</li></ul></li><li>所有核心模块在使用的时候都必须手动的先使用 <code>require</code> 方法来加载，然后才可以使用，例如：<ul><li><code>var fs = require(&#39;fs&#39;)</code></li></ul></li></ul><h3 id="4-http协议"><a href="#4-http协议" class="headerlink" title="4.http协议"></a>4.http协议</h3><p>http 这个模块的职责就是帮你创建编写服务器的。</p><ul><li><p>require</p></li><li><p>端口号</p><ul><li>ip 地址定位计算机</li><li>端口号定位具体的应用程序</li></ul></li><li><p>Content-Type</p><ul><li>服务器最好把每次响应的数据是什么内容类型都告诉客户端，而且要正确的告诉</li><li>不同的资源对应的 Content-Type 是不一样，具体参照：<a target="_blank" rel="noopener" href="http://tool.oschina.net/commons">http://tool.oschina.net/commons</a></li><li>对于文本类型的数据，最好都加上编码，目的是为了防止中文解析乱码问题</li></ul></li><li><p>它通过网络发送文件</p><ul><li>发送的并不是文件，本质上来讲发送是文件的内容</li><li>当浏览器收到服务器响应内容之后，就会根据你的 Content-Type 进行对应的解析处理</li></ul></li><li><p>它是一个模块系统</p></li><li><p>Express Web 开发框架</p><ul><li><code>npm install express</code></li></ul></li></ul><h3 id="5-ip地址和端口号"><a href="#5-ip地址和端口号" class="headerlink" title="5.ip地址和端口号"></a>5.ip地址和端口号</h3><p><img data-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200729181121523.png" alt="image-20200729181121523"></p><h3 id="6-服务器黑盒子"><a href="#6-服务器黑盒子" class="headerlink" title="6.服务器黑盒子"></a>6.服务器黑盒子</h3><p><img data-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200729181209875.png" alt="image-20200729181209875"></p><h2 id="模块化"><a href="#模块化" class="headerlink" title="模块化"></a>模块化</h2><h3 id="1-什么是模块化"><a href="#1-什么是模块化" class="headerlink" title="1.什么是模块化"></a>1.什么是模块化</h3><ol><li>模块化是指解决一个复杂问题时，自顶向下逐层把系统划分成若干模块的过程。对于整个系统来说，模块是可组合、分解和更换的单元</li><li>编程领域中的模块化，就是遵守固定的规则，把一个大文件拆成独立并互相依赖的多个小模块</li><li>把代码进行模块化拆分的好处<ul><li>提高了代码的复用性</li><li>提高了代码的可维护性</li><li>可以实现按需加载</li></ul></li></ol><h3 id="2-模块化相关的概念"><a href="#2-模块化相关的概念" class="headerlink" title="2.模块化相关的概念"></a>2.模块化相关的概念</h3><ol><li>模块化规范就是对代码进行模块化的拆分与组合时，需要遵守的那些规则，例如：</li></ol><ul><li>使用什么样的语法格式来引用模块</li><li>在模块中使用什么样的语法格式向外暴露成员</li></ul><ol start="2"><li><p>模块化规范的好处：大家都遵守同样的模块化规范写代码，降低了沟通的成本，极大方便了各个模块之间的相互调用，利人利己</p></li><li><p>Node 中的模块化</p></li></ol><h3 id="3-Node-中模块的-3-个大类"><a href="#3-Node-中模块的-3-个大类" class="headerlink" title="3.Node 中模块的 3 个大类"></a>3.Node 中模块的 3 个大类</h3><p>Node.js 中根据模块来源的不同，将模块分为了 3 大类，分别是：</p><ol><li>内置模块（内置模块是由 Node.js 官方提供的，例如 fs、path、http 等）</li><li>自定义模块（用户创建的每个 .js 文件，都是自定 义模块）</li><li>第三方模块（由第三方开发出来的模块，并非官方提供的内置模块，也不是用户创建的自定义模块，使用前需要先下载）</li></ol><h3 id="4-使用-require-方法加载模块"><a href="#4-使用-require-方法加载模块" class="headerlink" title="4.使用 require 方法加载模块"></a>4.使用 require 方法加载模块</h3><p>使用强大的 require() 方法，可以加载需要的内置模块、用户自定义模块、第三方模块进行使用。例如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 加载内置的 fs 模块</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 加载用户的自定义模块</span></span><br><span class="line"><span class="keyword">const</span> custom = <span class="built_in">require</span>(<span class="string">&#x27;./custom.js&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 加载第三方模块，(使用第三方模块，下面会进行讲解)</span></span><br><span class="line"><span class="keyword">const</span> moment = <span class="built_in">require</span>(<span class="string">&#x27;moment&#x27;</span>)</span><br><span class="line"><span class="number">12345678</span></span><br></pre></td></tr></table></figure><p>注意事项 1： 使用 require() 方法加载其他模块时，会执行被加载模块中的代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加载模块.js</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;./被加载的模块.js&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 被加载模块.js</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;我会被打印&#x27;</span>)</span><br><span class="line"><span class="number">123456</span></span><br></pre></td></tr></table></figure><p>注意事项2： 在使用 require 加载用户自定义模块期间，可以省略 .js 后缀名</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加载模块.js</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;./被加载的模块&#x27;</span>)</span><br></pre></td></tr></table></figure><p>注意事项3：require优先从缓存加载</p><ul><li>require优先从缓存加载，当有三个文档a,b,main.js。main.js加载b,而a加载的是b,所以这里不会重复加载，可以拿到其中的接口对象（require(‘./a’)），但是不会重复执行里面的代码，这样做的目的是为了避免重复加载，提高模块加载效率。</li></ul><h3 id="5-exports接口导出模块"><a href="#5-exports接口导出模块" class="headerlink" title="5.exports接口导出模块"></a>5.exports接口导出模块</h3><p>使用exports接口对象用来导出模块中的成员</p><ul><li>node中模块作用域，默认文件中所有的成员只在当前文件模块有效</li><li>对于希望可以被其他模块访问的成员，我们就需要把这些公开的成员都挂载到<code>exports</code>接口对象中就可以了</li><li>导出多个成员</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exports</span>.a=<span class="number">123</span></span><br><span class="line"><span class="built_in">exports</span>.b=<span class="string">&#x27;dsf&#x27;</span></span><br><span class="line"><span class="built_in">exports</span>.function()&#123;&#125;</span><br><span class="line"><span class="built_in">exports</span>.d=&#123;</span><br><span class="line">    foo:<span class="string">&#x27;dsaf&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>导出单个成员</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="string">&#x27;hello&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>以下情况会覆盖</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="string">&#x27;hello&#x27;</span></span><br><span class="line"><span class="comment">//后者会覆盖前者</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>也可以这样导出多个：</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  add: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line">  &#125;,</span><br><span class="line">  str: <span class="string">&#x27;hello&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注意导出的形式决定了引入的形式</p></blockquote><h2 id="HTTP协议"><a href="#HTTP协议" class="headerlink" title="HTTP协议"></a>HTTP协议</h2><h3 id="1-基本使用"><a href="#1-基本使用" class="headerlink" title="1.基本使用"></a>1.基本使用</h3><ul><li><p>加载 <code>http</code> 核心模块</p><ul><li><pre><code class="javascript">var http=require(&#39;http&#39;)
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 使用&#96; http.createServer() &#96;方法创建一个 Web 服务器</span><br><span class="line"></span><br><span class="line">  - &#96;&#96;&#96; javascript</span><br><span class="line">    var server &#x3D; http.createServer()</span><br></pre></td></tr></table></figure></code></pre></li></ul></li><li><p>当客户端请求过来，就会自动触发服务器的 request 请求事件，然后执行第二个参数：回调处理函数</p><ul><li><pre><code class="javascript">server.on(&#39;request&#39;, function (req,res) &#123;
  console.log(&#39;收到客户端的请求了&#39;)
&#125;)
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- request 请求事件处理函数，需要接收两个参数：</span><br><span class="line"></span><br><span class="line">  Request 请求对象</span><br><span class="line"></span><br><span class="line">  ​    请求对象可以用来获取客户端的一些请求信息，例如请求路径</span><br><span class="line"></span><br><span class="line">    Response 响应对象</span><br><span class="line"></span><br><span class="line">  ​    响应对象可以用来给客户端发送响应消息</span><br><span class="line"></span><br><span class="line">- 告诉客户端，我的话说完了，你可以呈递给用户了</span><br><span class="line"></span><br><span class="line">  &#96;&#96;&#96; javascript</span><br><span class="line">  response.end(data)</span><br></pre></td></tr></table></figure></code></pre></li><li><p>请求路径</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">req.url <span class="comment">//获取到的是端口号之后的那一部分路径</span></span><br></pre></td></tr></table></figure></li><li><p>响应</p><p>一个请求对应一个响应，如果在一个请求的过程中，已经结束响应了，则不能重复发送响应。</p><p>没有请求就没有响应。</p><p>响应内容只能是二进制数据或者字符串</p><ul><li>数字</li><li>对象</li><li>数组</li><li>布尔值</li></ul></li></ul></li><li><p>绑定端口号，启动服务器</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">server.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;服务器启动成功了，可以通过 http://127.0.0.1:3000/ 来进行访问&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>设置请求头：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server.writeHead(<span class="number">200</span>,&#123;<span class="string">&quot;content-Type&quot;</span>:<span class="string">&quot;text/plain;charset&quot;</span>&#125;)</span><br></pre></td></tr></table></figure></li><li><p>例子</p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 加载 http 核心模块</span></span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"><span class="comment">// 2. 使用 http.createServer() 方法创建一个 Web 服务器</span></span><br><span class="line"><span class="comment">//    返回一个 Server 实例</span></span><br><span class="line"><span class="keyword">var</span> server = http.createServer()</span><br><span class="line"><span class="comment">// 3. 服务器要干嘛？</span></span><br><span class="line"><span class="comment">//    提供服务：对 数据的服务</span></span><br><span class="line"><span class="comment">//    发请求</span></span><br><span class="line"><span class="comment">//    接收请求</span></span><br><span class="line"><span class="comment">//    处理请求</span></span><br><span class="line"><span class="comment">//    给个反馈（发送响应）</span></span><br><span class="line"><span class="comment">//    注册 request 请求事件</span></span><br><span class="line"><span class="comment">//    当客户端请求过来，就会自动触发服务器的 request 请求事件，然后执行第二个参数：回调处理函数</span></span><br><span class="line"><span class="comment">// request 请求事件处理函数，需要接收两个参数：</span></span><br><span class="line"><span class="comment">//    Request 请求对象</span></span><br><span class="line"><span class="comment">//        请求对象可以用来获取客户端的一些请求信息，例如请求路径</span></span><br><span class="line"><span class="comment">//    Response 响应对象</span></span><br><span class="line"><span class="comment">//        响应对象可以用来给客户端发送响应消息</span></span><br><span class="line">server.on(<span class="string">&#x27;request&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;收到客户端的请求了&#x27;</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;收到客户端的请求了，请求路径是：&#x27;</span> + request.url)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;请求我的客户端的地址是：&#x27;</span>, req.socket.remoteAddress, req.socket.remotePort)</span><br><span class="line">  <span class="comment">// response 对象有一个方法：write 可以用来给客户端发送响应数据</span></span><br><span class="line">  <span class="comment">// write 可以使用多次，但是最后一定要使用 end 来结束响应，否则客户端会一直等待</span></span><br><span class="line">  response.write(<span class="string">&#x27;hello&#x27;</span>)</span><br><span class="line">  response.write(<span class="string">&#x27; nodejs&#x27;</span>)</span><br><span class="line">  <span class="comment">// 告诉客户端，我的话说完了，你可以呈递给用户了</span></span><br><span class="line">  response.end()</span><br><span class="line"> <span class="comment">// 上面的方式比较麻烦，推荐使用更简单的方式，直接 end 的同时发送响应数据</span></span><br><span class="line">  <span class="comment">// res.end(&#x27;hello nodejs&#x27;)</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 4. 绑定端口号，启动服务器</span></span><br><span class="line">server.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;服务器启动成功了，可以通过 http://127.0.0.1:3000/ 来进行访问&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="2-客户端的重定向"><a href="#2-客户端的重定向" class="headerlink" title="2.客户端的重定向"></a>2.客户端的重定向</h3><p>前提：服务端已经把数据存储好了，接下来就是让用户重新请求 / 首页，就可以看到最新的留言内容了</p><p>步骤：</p><ul><li>状态码设置为 302 临时重定向<ul><li>statusCode</li></ul></li><li>在响应头中通过 Location 告诉客户端往哪儿重定向<ul><li>setHeader</li></ul></li></ul><p>如果客户端发现收到服务器的响应的状态码是 302 就会自动去响应头中找 Location ，然后对该地址发起新的请求, 所以你就能看到客户端自动跳转了</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">res.statusCode = <span class="number">302</span></span><br><span class="line">res.setHeader(<span class="string">&#x27;Location&#x27;</span>, <span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">res.end()</span><br></pre></td></tr></table></figure><h3 id="3-浏览器解析问题"><a href="#3-浏览器解析问题" class="headerlink" title="3.浏览器解析问题"></a>3.浏览器解析问题</h3><ul><li><p>浏览器收到 HTML 响应内容之后，就要开始从上到下依次解析，</p><p>当在解析的过程中，如果发现：</p><p>link</p><p>script</p><p>img</p><p>iframe</p><p>video</p><p>audio</p><p>等带有 src 或者 href（link） 属性标签（具有外链的资源）的时候，浏览器会自动对这些资源发起新的请求。</p></li><li><p><strong>注意</strong>：在服务端中，文件中的路径就不要去写相对路径了。</p><p>因为这个时候所有的资源都是通过 url 标识来获取的</p><p>我的服务器开放了 /public/ 目录</p><p>所以这里的请求路径都写成：/public/xxx</p><p>/ 在这里就是 url 根路径的意思。</p><p>浏览器在真正发请求的时候会最终把 <a target="_blank" rel="noopener" href="http://127.0.0.1:3000/">http://127.0.0.1:3000</a> 拼上</p></li></ul><h2 id="URL模块"><a href="#URL模块" class="headerlink" title="URL模块"></a>URL模块</h2><h3 id="1-基础"><a href="#1-基础" class="headerlink" title="1.基础"></a>1.基础</h3><blockquote><p>我们现在来看一下req里面能够使用的东西。<br>最关键的就是req.url属性，表示用户的请求URL地址。所有的路由设计，都是通过req.url来实现的。<br>我们比较关心的不是拿到URL，而是识别这个URL。</p></blockquote><ul><li>URL.parse(req.url,true) 将查询信息变为对象</li><li>也可以通过：URL.parse(req.url).query 转换</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="comment">//引入url模块</span></span><br><span class="line"><span class="keyword">var</span> URL = <span class="built_in">require</span>(<span class="string">&quot;url&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">      <span class="comment">//不处理小图标（浏览器地址旁边的小图标）</span></span><br><span class="line">    <span class="keyword">if</span>(req.url == <span class="string">&quot;/favicon.ico&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//url.parse()可以将一个完整的URL地址，分为很多部分：</span></span><br><span class="line">    <span class="comment">//host、port、pathname、path、query</span></span><br><span class="line">    <span class="keyword">var</span> pathname = URL.parse(req.url).pathname;</span><br><span class="line">    <span class="comment">//url.parse()如果第二个参数是true，那么就可以将所有的查询变为对象</span></span><br><span class="line">    <span class="comment">//就可以直接打点得到这个参数</span></span><br><span class="line">    <span class="keyword">var</span> query = URL.parse(req.url,<span class="literal">true</span>).query;      </span><br><span class="line">    <span class="keyword">var</span> url = URL.parse(req.url,<span class="literal">true</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(url);</span><br><span class="line">    res.end();</span><br><span class="line">&#125;);</span><br><span class="line">server.listen(<span class="number">3000</span>,<span class="string">&quot;127.0.0.1&quot;</span>);</span><br></pre></td></tr></table></figure><p>假设我们访问<a target="_blank" rel="noopener" href="http://127.0.0.1:3000/hcd?name=1">http://127.0.0.1:3000/hcd?name=1</a></p><p>则console.log(url)为：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Url &#123;</span><br><span class="line">  protocol: <span class="literal">null</span>,</span><br><span class="line">  slashes: <span class="literal">null</span>,</span><br><span class="line">  auth: <span class="literal">null</span>,</span><br><span class="line">  host: <span class="literal">null</span>,</span><br><span class="line">  port: <span class="literal">null</span>,</span><br><span class="line">  hostname: <span class="literal">null</span>,</span><br><span class="line">  hash: <span class="literal">null</span>,</span><br><span class="line">  search: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  query: &#123;&#125;,   <span class="comment">// URL.parse(req.url,true)28</span></span><br><span class="line">  pathname: <span class="string">&#x27;/hcd?name=1&#x27;</span>,</span><br><span class="line">  path: <span class="string">&#x27;/hcd?name=1&#x27;</span>,</span><br><span class="line">  href: <span class="string">&#x27;/hcd?name=1&#x27;</span> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-编写一个路由router"><a href="#2-编写一个路由router" class="headerlink" title="2.编写一个路由router"></a>2.编写一个路由router</h3><p>可以通过<code>req.url</code>制作路由<code>router</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//得到url</span></span><br><span class="line">    <span class="keyword">var</span> userurl = req.url;</span><br><span class="line">    res.writeHead(<span class="number">200</span>,&#123;<span class="string">&quot;Content-Type&quot;</span>:<span class="string">&quot;text/html;charset=UTF8&quot;</span>&#125;)</span><br><span class="line">    <span class="comment">//如果请求的地址为&quot;/student&quot;</span></span><br><span class="line">    <span class="keyword">if</span>(userurl == <span class="string">&quot;/student&quot;</span>)&#123;</span><br><span class="line">        res.end(<span class="string">&quot;student&quot;</span>);     </span><br><span class="line">    <span class="comment">//如果请求的地址为&quot;/teacher&quot;</span></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(userurl == <span class="string">&quot;/teacher&quot;</span>)&#123;</span><br><span class="line">        res.end(<span class="string">&quot;teacher&quot;</span>);</span><br><span class="line">    <span class="comment">//如果请求的地址没有</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        res.end(<span class="string">&quot;404&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>,<span class="string">&quot;127.0.0.1&quot;</span>);</span><br></pre></td></tr></table></figure><h2 id="node中的模板"><a href="#node中的模板" class="headerlink" title="node中的模板"></a>node中的模板</h2><h3 id="1-使用"><a href="#1-使用" class="headerlink" title="1.使用"></a>1.使用</h3><ul><li><p><code>art-template</code> 不仅可以在浏览器使用，也可以在 node 中使用</p></li><li><p>安装：</p><ul><li><p><code>npm install art-template</code></p></li><li><p>该命令在哪执行就会把包下载到哪里。默认会下载到 <code>node_modules</code>目录中</p></li><li><p><code>node_modules</code>不要改，也不支持改。</p></li></ul></li><li><p>在需要使用的文件模块中加载 art-template</p><ul><li><p>只需要使用 require 方法加载就可以了：require(‘art-template’)</p></li><li><p>参数中的 art-template 就是你下载的包的名字</p></li><li><p>也就是说你 <code>isntall</code> 的名字是什么，则你 <code>require</code> 中的就是什么</p></li></ul></li><li><p>查文档，使用模板引擎的 <code>API</code></p></li></ul><h3 id="2-data值的使用"><a href="#2-data值的使用" class="headerlink" title="2.data值的使用"></a>2.data值的使用</h3><ul><li>默认读取到的 data 是二进制数据</li><li>而模板引擎的 render 方法需要接收的是字符串</li><li>所以我们在这里需要把 data 二进制数据转为 字符串 才可以给模板引擎使用</li></ul><h3 id="3-each的辨别"><a href="#3-each的辨别" class="headerlink" title="3.each的辨别"></a>3.each的辨别</h3><ol><li>art-template中的each</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这是 art-template 模板引擎支持的语法，只能在模板字符串中使用</span></span><br><span class="line">&#123;&#123;each 数组&#125;&#125;</span><br><span class="line">	&lt;li&gt;&#123;&#123; $value &#125;&#125;&lt;/li&gt;</span><br><span class="line">&#123;&#123;/each&#125;&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>jquery中的each</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$.each(数组, <span class="function"><span class="keyword">function</span>)</span></span><br><span class="line"><span class="function">// 遍历 <span class="title">jQuery</span> 选择器选择到的伪数组实例对象</span></span><br><span class="line"><span class="function"><span class="title">$</span>(<span class="params"><span class="string">&#x27;div&#x27;</span></span>).<span class="title">each</span>(<span class="params">function</span>)</span></span><br></pre></td></tr></table></figure><ol start="3"><li>EcmaScript 5 中的一个数组遍历函数</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// forEach 是 EcmaScript 5 中的一个数组遍历函数，是 JavaScript 原生支持的遍历方法 可以遍历任何可以被遍历的成员</span></span><br></pre></td></tr></table></figure><h3 id="4-渲染"><a href="#4-渲染" class="headerlink" title="4.渲染"></a>4.渲染</h3><ol><li>在html文件中写好要渲染的部分</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;大家好，我叫：&#123;&#123; name &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;我今年 &#123;&#123; age &#125;&#125; 岁了&lt;/p&gt;</span><br><span class="line">&lt;h1&gt;我来自 &#123;&#123; province &#125;&#125;&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;我喜欢：&#123;&#123;each hobbies&#125;&#125; &#123;&#123; $value &#125;&#125; &#123;&#123;<span class="regexp">/each&#125;&#125;&lt;/</span>p&gt;</span><br></pre></td></tr></table></figure><ol start="2"><li>其次在node中安装<code>art-template</code>模板引擎，在文件中加载它。</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> template = <span class="built_in">require</span>(<span class="string">&#x27;art-template&#x27;</span>)</span><br></pre></td></tr></table></figure><ol start="3"><li>最后读取<code>html</code>文件，把数据转换为字符串给模板引擎</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">fs.readFile(<span class="string">&#x27;./tpl.html&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">console</span>.log(<span class="string">&#x27;读取文件失败了&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 默认读取到的 data 是二进制数据</span></span><br><span class="line">    <span class="comment">// 而模板引擎的 render 方法需要接收的是字符串</span></span><br><span class="line">    <span class="comment">// 所以我们在这里需要把 data 二进制数据转为 字符串 才可以给模板引擎使用</span></span><br><span class="line">    <span class="keyword">var</span> ret = template.render(data.toString(), &#123;</span><br><span class="line">        name: <span class="string">&#x27;Jack&#x27;</span>,</span><br><span class="line">        age: <span class="number">18</span>,</span><br><span class="line">        province: <span class="string">&#x27;北京市&#x27;</span>,</span><br><span class="line">        hobbies: [</span><br><span class="line">            <span class="string">&#x27;写代码&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;唱歌&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;打游戏&#x27;</span></span><br><span class="line">        ],</span><br><span class="line">        title: <span class="string">&#x27;个人信息&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(ret)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="5-其他模板"><a href="#5-其他模板" class="headerlink" title="5.其他模板"></a>5.其他模板</h3><p><strong>ejs</strong></p><h2 id="fs模块"><a href="#fs模块" class="headerlink" title="fs模块"></a>fs模块</h2><h3 id="1-文件夹操作"><a href="#1-文件夹操作" class="headerlink" title="1.文件夹操作"></a>1.文件夹操作</h3><ol><li>创建目录</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.mkdir(path[, options], callback)</span><br></pre></td></tr></table></figure><ul><li><strong>path</strong> - 文件路径。</li><li>options 参数可以是：<ul><li><strong>recursive</strong> - 是否以递归的方式创建目录，默认为 false。</li><li><strong>mode</strong> - 设置目录权限，默认为 0777。</li></ul></li><li><strong>callback</strong> - 回调函数，没有参数。</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fs.mkdir(<span class="string">&#x27;/tmp/a/apple&#x27;</span>, &#123; <span class="attr">recursive</span>: <span class="literal">true</span> &#125;, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ol start="2"><li>读取目录 <code>fs.readdir(path, callback)</code></li><li>删除目录的语法格式:<code>fs.rmdir(path, callback)</code></li></ol><h3 id="2-文件操作"><a href="#2-文件操作" class="headerlink" title="2.文件操作"></a>2.文件操作</h3><ol><li>打开文件</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.open(path, flags[, mode], callback)</span><br></pre></td></tr></table></figure><ul><li><strong>path</strong> - 文件的路径。</li><li><strong>flags</strong> - 文件打开的行为。具体值详见下文。</li><li><strong>mode</strong> - 设置文件模式(权限)，文件创建默认权限为 0666(可读，可写)。</li><li><strong>callback</strong> - 回调函数，带有两个参数如：callback(err, fd)。</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 异步打开文件</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;准备打开文件！&quot;</span>);</span><br><span class="line"><span class="comment">// &#x27;r+&#x27; 代表以读写模式打开文件。如果文件不存在抛出异常</span></span><br><span class="line">fs.open(<span class="string">&#x27;input.txt&#x27;</span>, <span class="string">&#x27;r+&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, fd</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (err) &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">   &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;文件打开成功！&quot;</span>);     </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ol start="2"><li>获取文件信息</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.stat(path, callback)</span><br></pre></td></tr></table></figure><ul><li><strong>path</strong> - 文件路径。</li><li><strong>callback</strong> - 回调函数，带有两个参数如：(err, stats), <strong>stats</strong> 是 fs.stats 对象。</li></ul><ol start="3"><li>写入文件</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.writeFile(file, data[, options], callback)</span><br></pre></td></tr></table></figure><blockquote><p>writeFile 直接打开文件默认是 <strong>w</strong> 模式，所以如果文件存在，该方法写入的内容会覆盖旧的文件内容。</p></blockquote><ul><li><strong>file</strong> - 文件名或文件描述符。</li><li><strong>data</strong> - 要写入文件的数据，可以是 String(字符串) 或 Buffer(缓冲) 对象。</li><li><strong>options</strong> - 该参数是一个对象，包含 {encoding, mode, flag}。默认编码为 utf8, 模式为 0666 ， flag 为 ‘w’</li><li><strong>callback</strong> - 回调函数，回调函数只包含错误信息参数(err)，在写入失败时返回。</li></ul><ol start="4"><li>关闭文件</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.close(fd, callback)</span><br></pre></td></tr></table></figure><ul><li><strong>fd</strong> - 通过 fs.open() 方法返回的文件描述符。</li><li><strong>callback</strong> - 回调函数，没有参数</li></ul><ol start="5"><li>读取文件</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fs.readFile(<span class="string">&#x27;/etc/passwd&#x27;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">  <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="其他模块"><a href="#其他模块" class="headerlink" title="其他模块"></a>其他模块</h2><h3 id="1-os模块"><a href="#1-os模块" class="headerlink" title="1.os模块"></a>1.os模块</h3><p><code>os</code>用来获取机器信息的</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> os = <span class="built_in">require</span>(<span class="string">&#x27;os&#x27;</span>)</span><br><span class="line"><span class="comment">// 获取当前机器的 CPU 信息</span></span><br><span class="line"><span class="built_in">console</span>.log(os.cpus())</span><br><span class="line"><span class="comment">// memory 内存</span></span><br><span class="line"><span class="built_in">console</span>.log(os.totalmem())</span><br></pre></td></tr></table></figure><h3 id="2-path模块"><a href="#2-path模块" class="headerlink" title="2.path模块"></a>2.path模块</h3><p>用来操作路径的</p><p><strong>path.extname() 方法返回 path 的扩展名</strong></p><p>即从 path 的最后一部分中的最后一个 .（句号）字符到字符串结束。 如果 path 的最后一部分没有 . 或 path 的文件名（见 path.basename()）的第一个字符是 .，则返回一个空字符串。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="comment">// 获取一个路径中的扩展名部分</span></span><br><span class="line"><span class="comment">// extname extension name</span></span><br><span class="line"><span class="built_in">console</span>.log(path.extname(<span class="string">&#x27;c:/a/b/c/d/hello.txt&#x27;</span>))</span><br></pre></td></tr></table></figure><h2 id="第三方模块"><a href="#第三方模块" class="headerlink" title="第三方模块"></a>第三方模块</h2><ul><li><p>凡是第三方模块都必须通过 npm 来下载</p><p>使用的时候就可以通过 require(‘包名’) 的方式来进行加载才可以使用</p><p>不可能有任何一个第三方包和核心模块的名字是一样的</p><p>既不是核心模块、也不是路径形式的模块</p><ul><li><p>先找到当前文件所处目录中的 node_modules 目录</p><p>node_modules/art-template</p><p>node_modules/art-template/package.json 文件</p><p>node_modules/art-template/package.json 文件中的 main 属性</p><p>main 属性中就记录了 art-template 的入口模块</p><p>然后加载使用这个第三方包</p><p>实际上最终加载的还是文件</p></li><li><p>如果 package.json 文件不存在或者 main 指定的入口模块是也没有</p><p>则 node 会自动找该目录下的 index.js</p><p>也就是说 index.js 会作为一个默认备选项</p><p>如果以上所有任何一个条件都不成立，则会进入上一级目录中的 node_modules 目录查找</p><p>如果上一级还没有，则继续往上上一级查找</p><p>。。。</p><p>如果直到当前磁盘根目录还找不到，最后报错：</p><p>can not find module xxx</p></li></ul><blockquote><p>备注：我们一个项目有且只有一个 node_modules，放在项目根目录中，这样的话项目中所有的子目录中的代码都可以加载到第三方包不会出现有多个 node_modules。</p></blockquote></li></ul><h2 id="Express框架"><a href="#Express框架" class="headerlink" title="Express框架"></a>Express框架</h2><p>原生的http在某些方面表现不足以应对我们的开发需求，所以我就需要使用框架来加快我们的开发效率，框架的目的：提高效率，代码高度统一。</p><p>官网：expressjs.com</p><h3 id="1-安装："><a href="#1-安装：" class="headerlink" title="1.安装："></a>1.安装：</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//包的下载安装</span></span><br><span class="line">npm install express</span><br></pre></td></tr></table></figure><ul><li><p>package.json</p><p>我们建议每一个项目都要有一个<code>package.json</code>文件（包描述文件，就像说明书一样），给人踏实的感觉。</p><p>这个文件可以通过<code>npm init</code>or <code>npm init --y</code>的方式来自动初始化。</p></li><li><p>“dependencies”选项</p><p>对于目前来讲，最有用的是”dependencies”选项，可以来帮我们保存第三方包的依赖信息。如果你的<code>node_modules</code>删除了也不用担心，我们只要执行<code>npm install</code>就会自动把<code>package.json</code>中的<code>dependencies</code>中所有的依赖项都下载回来。</p><ul><li>建议每个项目的根目录下都有一个package.json文件</li><li>建议执行npm install 包名的 时候都加上 <code>--save</code>这个选项，目的是用来保存依赖项信息。</li></ul></li></ul><h3 id="2-hello-worrd"><a href="#2-hello-worrd" class="headerlink" title="2.hello worrd"></a>2.hello worrd</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 0. 安装</span></span><br><span class="line"><span class="comment">// 1. 引包</span></span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 创建你服务器应用程序</span></span><br><span class="line"><span class="comment">//    也就是原来的 http.createServer</span></span><br><span class="line"><span class="keyword">var</span> app = express()</span><br><span class="line">app.get(<span class="string">&#x27;/about&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 在 Express 中可以直接 req.query 来获取查询字符串参数</span></span><br><span class="line">  <span class="built_in">console</span>.log(req.query)</span><br><span class="line">  res.send(<span class="string">&#x27;Express! hello world&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 相当于 server.listen</span></span><br><span class="line">app.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;app is running at port 3000.&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="3-基本路由"><a href="#3-基本路由" class="headerlink" title="3.基本路由"></a>3.基本路由</h3><p>路由器—-&gt;路由表</p><p>get:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//当你以GET方式请求 / 的时候，执行对应处理的处理函数</span></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">    res.send(<span class="string">&#x27;Hello World!&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>post:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//当你以GET方式请求 / 的时候，执行对应处理的处理函数</span></span><br><span class="line">app.post(<span class="string">&#x27;/&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">    res.send(<span class="string">&#x27;Hello World!&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>put:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.put(<span class="string">&#x27;/user&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.send(<span class="string">&#x27;Got a PUT request at /user&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>delete:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 当以delete方法请求“/user”的时候，执行删除操作。</span></span><br><span class="line">app.delete(<span class="string">&#x27;/user&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.send(<span class="string">&#x27;Got a DELETE request at /user&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="4-静态服务"><a href="#4-静态服务" class="headerlink" title="4.静态服务"></a>4.静态服务</h3><p>为了提供诸如图像、CSS 文件和 JavaScript 文件之类的静态文件，请使用 Express 中的 <code>express.static</code> 内置中间件函数。</p><p>此函数特征如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">express.static(root, [options])</span><br></pre></td></tr></table></figure><p>通过如下代码就可以将 <code>public</code> 目录下的图片、CSS 文件、JavaScript 文件对外开放访问了：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.use(express.static(<span class="string">&#x27;public&#x27;</span>))</span><br></pre></td></tr></table></figure><p>现在，你就可以访问 <code>public</code> 目录中的所有文件了：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost:3000&#x2F;images&#x2F;kitten.jpg</span><br><span class="line">http:&#x2F;&#x2F;localhost:3000&#x2F;css&#x2F;style.css</span><br><span class="line">http:&#x2F;&#x2F;localhost:3000&#x2F;js&#x2F;app.js</span><br><span class="line">http:&#x2F;&#x2F;localhost:3000&#x2F;images&#x2F;bg.png</span><br><span class="line">http:&#x2F;&#x2F;localhost:3000&#x2F;hello.html</span><br></pre></td></tr></table></figure><blockquote><p>Express 在静态目录查找文件，因此，存放静态文件的目录名不会出现在 URL 中。</p></blockquote><p>如果要使用多个静态资源目录，请多次调用 <code>express.static</code> 中间件函数：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">app.use(express.static(<span class="string">&#x27;public&#x27;</span>))</span><br><span class="line">app.use(express.static(<span class="string">&#x27;files&#x27;</span>))</span><br></pre></td></tr></table></figure><h3 id="5-使用成器工具-express-generator创建一个应用的骨架"><a href="#5-使用成器工具-express-generator创建一个应用的骨架" class="headerlink" title="5.使用成器工具 express-generator创建一个应用的骨架"></a>5.使用成器工具 <code>express-generator</code>创建一个应用的骨架</h3><ol><li>可以通过 <code>npx</code> （包含在 Node.js 8.2.0 及更高版本中）命令来<strong>运行 Express 应用程序生成器</strong>。</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npx express-generator</span><br></pre></td></tr></table></figure><p>对于较老的 Node 版本，请通过 npm 将 Express 应用程序生成器安装到全局环境中并执行即可。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm install -g express-generator</span><br><span class="line">$ express</span><br></pre></td></tr></table></figure><p><code>-h</code> 参数可以列出所有可用的命令行参数</p><ol start="2"><li><strong>安装所有依赖包</strong></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd myapp</span><br><span class="line">$ npm install</span><br></pre></td></tr></table></figure><ol start="3"><li><strong>启动应用</strong></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ DEBUG=name:* npm start</span><br></pre></td></tr></table></figure><p>通过生成器创建的应用一般都有如下目录结构：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── app.js</span><br><span class="line">├── bin</span><br><span class="line">│   └── www</span><br><span class="line">├── package.json</span><br><span class="line">├── public</span><br><span class="line">│   ├── images</span><br><span class="line">│   ├── javascripts</span><br><span class="line">│   └── stylesheets</span><br><span class="line">│       └── style.css</span><br><span class="line">├── routes</span><br><span class="line">│   ├── index.js</span><br><span class="line">│   └── users.js</span><br><span class="line">└── views</span><br><span class="line">    ├── error.pug</span><br><span class="line">    ├── index.pug</span><br><span class="line">    └── layout.pug</span><br><span class="line"></span><br><span class="line">7 directories, 9 files</span><br></pre></td></tr></table></figure><h3 id="6-expepress中使用art-template"><a href="#6-expepress中使用art-template" class="headerlink" title="6.expepress中使用art-template"></a>6.expepress中使用art-template</h3><p>安装：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install --save art-template</span><br><span class="line">npm install --save express-art-template</span><br></pre></td></tr></table></figure><p>配置</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.engine(<span class="string">&#x27;html&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;express-art-template&#x27;</span>))</span><br></pre></td></tr></table></figure><p>使用：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Express 为 Response 相应对象提供了一个方法：render</span></span><br><span class="line"><span class="comment">// render 方法默认是不可以使用，但是如果配置了模板引擎就可以使用了</span></span><br><span class="line"><span class="comment">// res.render(&#x27;html模板名&#x27;, &#123;模板数据&#125;)--&gt;模板中要修改的数据部分</span></span><br><span class="line"><span class="comment">// req.query 只能拿 get 请求参数</span></span><br><span class="line">   <span class="comment">// console.log(req.query)</span></span><br><span class="line"><span class="comment">// 第一个参数不能写路径，默认会去项目中的 views 目录查找该模板文件</span></span><br><span class="line"><span class="comment">// 也就是说 Express 有一个约定：开发人员把所有的视图文件都放到 views 目录中</span></span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.render(<span class="string">&#x27;index.html&#x27;</span>, &#123;</span><br><span class="line">        comments: comments</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>如果希望修改默认的<code>views</code>视图渲染存储目录，就可以：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注意：第一个参数不能写错</span></span><br><span class="line">app.set(<span class="string">&#x27;views&#x27;</span>, render函数的默认路径，即下次的默认路径)</span><br></pre></td></tr></table></figure><h3 id="7-获取表单请求体数据"><a href="#7-获取表单请求体数据" class="headerlink" title="7.获取表单请求体数据"></a>7.获取表单请求体数据</h3><h4 id="1-在Express获取表单GET请求体数据"><a href="#1-在Express获取表单GET请求体数据" class="headerlink" title="1.在Express获取表单GET请求体数据"></a>1.在Express获取表单GET请求体数据</h4><p>express内置了一个API,可以直接使用</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">req.query</span><br></pre></td></tr></table></figure><h4 id="2-在Express获取表单POST请求体数据"><a href="#2-在Express获取表单POST请求体数据" class="headerlink" title="2.在Express获取表单POST请求体数据"></a>2.在Express获取表单POST请求体数据</h4><p>在Express中没有内置获取表单post请求体的API,这里我们需要使用一个第三方包：<code>body-parser</code></p><p>安装：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save body-parser</span><br></pre></td></tr></table></figure><p>配置：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="comment">//1.先引包</span></span><br><span class="line"><span class="keyword">var</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = express()</span><br><span class="line"><span class="comment">//配置body-parser</span></span><br><span class="line"><span class="comment">//只要加入这个配置，则在req请求对象上会多出来一个属性：body</span></span><br><span class="line"><span class="comment">//也就是说你就可以直接通过req.body来获取表单post请求体数据了</span></span><br><span class="line"><span class="comment">// parse application/x-www-form-urlencoded</span></span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// parse application/json</span></span><br><span class="line">app.use(bodyParser.json())</span><br><span class="line"></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.setHeader(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/plain&#x27;</span>)</span><br><span class="line">  res.write(<span class="string">&#x27;you posted:\n&#x27;</span>)</span><br><span class="line">  <span class="comment">//可以通过req.body来获取表单post请求体数据</span></span><br><span class="line">  res.end(<span class="built_in">JSON</span>.stringify(req.body, <span class="literal">null</span>, <span class="number">2</span>))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="8-path路径绝对化"><a href="#8-path路径绝对化" class="headerlink" title="8.path路径绝对化"></a>8.path路径绝对化</h3><p><a target="_blank" rel="noopener" href="https://nodejs.org/dist/latest-v12.x/docs/api/path.html">参考文件</a></p><ul><li>path.basename<ul><li>获取一个路径的文件名</li></ul></li><li>path.dirname<ul><li>获取一个路径中的目录部分。</li></ul></li><li>path.extname<ul><li>获取一个路径中的扩展名部分。</li></ul></li><li>path.parse<ul><li>把一个路径转化为对象<ul><li>root 根路径</li><li>dir 目录</li><li>base 包含后缀名的文件名</li><li>ext 后缀名</li><li>name 不包括后缀名的文件</li></ul></li></ul></li><li>path.join<ul><li>当需要路径拼接的时候，推荐使用这个方法</li></ul></li><li>path.isAbsolute<ul><li>判断一个路径是否为绝对路径</li></ul></li></ul><h2 id="Express中间件"><a href="#Express中间件" class="headerlink" title="Express中间件"></a>Express中间件</h2><p>中间件的本质就是一个请求的处理方法，我们把用户从请求到响应的整个过程分发到多个中间件中去处理，这样做的目的是提高代码的灵活性，动态可扩展的。</p><blockquote><p>同一个请求所经过的中间件都是同一个请求对象和响应对象。</p></blockquote><p><strong>中间件本身是一个方法，该方法接收三个参数：</strong>(Request,Response,next)</p><ul><li>Request 请求对象</li><li>Response 响应对象</li><li>next 下一个中间件</li></ul><blockquote><p><strong>当一个请求进入一个中间件之后，如果不调用 next 则会停留在当前中间件，</strong>所以 next 是一个方法，用来调用下一个中间件的</p></blockquote><h3 id="1-应用程序级别中间件"><a href="#1-应用程序级别中间件" class="headerlink" title="1.应用程序级别中间件"></a>1.应用程序级别中间件</h3><p>万能匹配（不关心请求路径和请求方法）。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.use(<span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">  next()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>只要是以‘/xxx’开头的</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.use(<span class="string">&#x27;/b&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="2-路由级别中间件"><a href="#2-路由级别中间件" class="headerlink" title="2.路由级别中间件"></a>2.路由级别中间件</h3><p>get:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">&#x27;/abc&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;abc&#x27;</span>)</span><br><span class="line">  next()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>post:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.post(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;/ 2&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>put:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.put(<span class="string">&#x27;/user&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  res.send(<span class="string">&#x27;Got a  PUT request at /user&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="3-错误处理中间件"><a href="#3-错误处理中间件" class="headerlink" title="3.错误处理中间件"></a>3.错误处理中间件</h3><blockquote><p>err,req, res, next 四个参数必须写全</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">app.use(<span class="function"><span class="keyword">function</span> (<span class="params">err,req, res, next</span>) </span>&#123; <span class="comment">//四个参数必须写全</span></span><br><span class="line">  <span class="built_in">console</span>.error(<span class="string">&#x27;err.stack&#x27;</span>)</span><br><span class="line">  res.status(<span class="number">500</span>).send(<span class="string">&#x27;something broke!&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//在发生错误的时候，调用next传递错误信息；next(err)</span></span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  fs.readFile(<span class="string">&#x27;.d/sa./d.sa/.dsa&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="comment">// return res.status(500).send(&#x27;Server Error&#x27;)</span></span><br><span class="line">      <span class="comment">// 当调用 next 的时候，如果传递了参数，则直接往后找到带有 四个参数的应用程序级别中间件</span></span><br><span class="line">      <span class="comment">// 当发生错误的时候，我们可以调用 next 传递错误对象</span></span><br><span class="line">      <span class="comment">// 然后就会被全局错误处理中间件匹配到并处理之</span></span><br><span class="line">      next(err)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="4-第三方中间件"><a href="#4-第三方中间件" class="headerlink" title="4.第三方中间件"></a>4.第三方中间件</h3><p>[<a target="_blank" rel="noopener" href="http://expressjs.com/en/resources/middleware.html]">http://expressjs.com/en/resources/middleware.html]</a>:</p><ul><li><a target="_blank" rel="noopener" href="http://expressjs.com/en/resources/middleware/body-parser.html">body-parser</a></li><li><a target="_blank" rel="noopener" href="http://expressjs.com/en/resources/middleware/compression.html">compression</a></li><li><a target="_blank" rel="noopener" href="http://expressjs.com/en/resources/middleware/cookie-parser.html">cookie-parser</a></li><li><a target="_blank" rel="noopener" href="http://expressjs.com/en/resources/middleware/morgan.html">morgan</a></li><li><a target="_blank" rel="noopener" href="http://expressjs.com/en/resources/middleware/response-time.html">response-time</a></li><li><a target="_blank" rel="noopener" href="http://expressjs.com/en/resources/middleware/serve-static.html">serve-static</a></li><li><a target="_blank" rel="noopener" href="http://expressjs.com/en/resources/middleware/session.html">session</a></li><li><a target="_blank" rel="noopener" href="http://expressjs.com/en/resources/middleware/cors.html">cors</a></li></ul><blockquote><p>内置中间件：<a target="_blank" rel="noopener" href="http://expressjs.com/en/4x/api.html#express.static">express.static</a> 、<a target="_blank" rel="noopener" href="http://expressjs.com/en/4x/api.html#express.json">express.json</a> 、<a target="_blank" rel="noopener" href="http://expressjs.com/en/4x/api.html#express.urlencoded">express.urlencoded</a></p></blockquote><h2 id="node中的非模块成员"><a href="#node中的非模块成员" class="headerlink" title="node中的非模块成员"></a>node中的非模块成员</h2><p>在每个模块中，除了<code>exports``require</code>等模块相关API之外，还有两个特殊的成员：</p><ul><li><code>__dirname</code><strong>动态的获取</strong>可以用来获取当前文件模块所属目录的绝对路径</li><li><code>__filename</code><strong>动态获取</strong>可以用来获 取当前文件的绝对路径</li><li><code>__dirname</code>和<code>__filename</code>是不受执行node命令所属路径</li></ul><p>在文件操作的过程中，使用相对路径是不可靠的，因为在node中的文件操作路径被设计为相对于执行node命令所处的路径（不是bug，人家这样设计是有使用场景的）。</p><p>所以为了解决这一问题，需要把相对路径改为绝对路径。即使用<code>__dirname</code><strong>动态的获取</strong>绝对路径，此过程推荐使用<code>path.join()</code>来辅助拼接。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path.join(__dirname, <span class="string">&#x27;文件名&#x27;</span>)</span><br></pre></td></tr></table></figure><p>**以后文件操作中使用的相对路径都统一转化为 动态的绝对路径 **</p><blockquote><p>补充：模块中的路径标识和这里的路径没关系，不受影响（相对于文件模块）。</p></blockquote><h2 id="koa2"><a href="#koa2" class="headerlink" title="koa2"></a>koa2</h2><p>koa 是由 Express 原班人马打造的，致力于成为一个更小、更富有表现力、更健壮的 Web 框架，也是目前流行的基于Node.js的Web开发框架,号称下一代web框架。 更小、更快速、更灵活、极简、开放开源的 web 开发框架。</p><p><a target="_blank" rel="noopener" href="https://www.itying.com/koa/">API</a></p><h3 id="1-搭建环境"><a href="#1-搭建环境" class="headerlink" title="1.搭建环境"></a>1.搭建环境</h3><ul><li>首先</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd code  //进入code文件夹</span><br><span class="line">mkdir koa2 //创建koa2文件夹</span><br><span class="line">cd koa2  //进入koa2文件夹</span><br></pre></td></tr></table></figure><ul><li>初始化生产package.json 文件</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init -y</span><br></pre></td></tr></table></figure><ul><li>生成package.json后，安装koa包，我们这里使用npm来进行安装</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install koa -D</span><br></pre></td></tr></table></figure><p>koa2也有像Express一样的应用生成器，通过应用koa脚手架生成工具 可以快速创建一个基于koa2的应用的骨架。</p><p>通过如下命令安装：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install koa-generator -g</span><br></pre></td></tr></table></figure><p>安装所有依赖包</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> koa_demo </span><br><span class="line">$ npm install</span><br></pre></td></tr></table></figure><p>启动这个应用</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DEBUG=myapp npm star</span><br><span class="line">// 或者 npm start</span><br></pre></td></tr></table></figure><h3 id="2-HelloKoa2"><a href="#2-HelloKoa2" class="headerlink" title="2.HelloKoa2"></a>2.<strong>HelloKoa2</strong></h3><p>在根目录下新建index.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"></span><br><span class="line"><span class="comment">//配置koa中间件</span></span><br><span class="line">app.use( <span class="keyword">async</span> ( ctx ) =&gt; &#123;</span><br><span class="line">  ctx.body = <span class="string">&#x27;hello koa2&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 监听端口</span></span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;[demo] start-quick is starting at port 3000&#x27;</span>)</span><br></pre></td></tr></table></figure><blockquote><p>ctx是koa自带的对象，Koa Context 将 node 的 <code>request</code> 和 <code>response</code> 对象封装到单个对象中，<em>每个</em> 请求都将创建一个 <code>Context</code>，并在中间件中作为接收器引用，或者 <code>ctx</code> 标识符</p></blockquote><p>编写完成后在命令行中输入：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node index.js</span><br></pre></td></tr></table></figure><p>然后在浏览器中输入：<a target="_blank" rel="noopener" href="http://127.0.0.1:3000/">http://127.0.0.1:3000</a> 就可以看到结果了。</p><h3 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h3><p>定义：</p><ul><li>中间件就是匹配路由之前或者匹配路由完成做的一系列的操作，我们就可以把它叫做中间件。</li><li>express中间件（Middleware） 是一个函数，它可以访问请求对象（request object (req)）, 响应对象（response object (res)）, 和 web 应用中处理请求-响应循环流程中的中间件，一般被命名为 next 的变量。在Koa中中间件和express有点类似。</li></ul><p>功能：</p><ul><li>执行任何代码。</li><li>修改请求和响应对象。</li><li>终结请求-响应循环。</li><li>调用堆栈中的下一个中间件。</li></ul><p><strong>Koa应用中间件：</strong></p><ul><li>应用级中间件</li><li>路由级中间件</li><li>错误处理中间件</li><li>第三方中间件</li></ul><p>Koa中间件的执行顺序：</p><p><a target="_blank" rel="noopener" href="https://www.itying.com/koa/data/news/image/20180406/20180406134220_35560.png">https://www.itying.com/koa/data/news/image/20180406/20180406134220_35560.png</a></p><p><img data-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200816105004618.png" alt="image-20200816105004618"></p><h3 id="3-get请求"><a href="#3-get请求" class="headerlink" title="3.get请求"></a>3.get请求</h3><blockquote><p>获得GET请求的方式有两种，一种是从request中获得，一种是一直从上下文中获得。获得的格式也有两种：query和querystring。</p></blockquote><h4 id="query和querystring区别"><a href="#query和querystring区别" class="headerlink" title="query和querystring区别"></a><strong>query和querystring区别</strong></h4><p><strong>在koa2中GET请求通过request接收</strong>，但是接收的方法有两种：query和querystring。</p><ul><li>query：返回的是格式化好的参数对象。</li><li>querystring：返回的是请求字符串。</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line">app.use(<span class="keyword">async</span>(ctx)=&gt;&#123;</span><br><span class="line">    <span class="keyword">let</span> url =ctx.url;</span><br><span class="line">    <span class="keyword">let</span> request =ctx.request;</span><br><span class="line">    <span class="keyword">let</span> req_query = request.query;</span><br><span class="line">    <span class="keyword">let</span> req_querystring = request.querystring;</span><br><span class="line"></span><br><span class="line">    ctx.body=&#123;</span><br><span class="line">        url,</span><br><span class="line">        req_query,</span><br><span class="line">        req_querystring</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;[demo] server is starting at port 3000&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>编写好后，在终端中使用node demo1.js启动服务。启动一切正常可在浏览器中使用[<a target="_blank" rel="noopener" href="http://127.0.0.1:3000/?user=jspang&amp;age=18%E6%9D%A5%E8%BF%9B%E8%A1%8C%E8%AE%BF%E9%97%AE%E3%80%82%E6%88%91%E4%BB%AC%E5%9C%A8%E7%BD%91%E9%A1%B5%E4%B8%AD%E5%8F%AF%E4%BB%A5%E5%BE%97%E5%88%B0%E4%B8%80%E4%B8%B2JSON%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%8C%E8%BF%99%E6%98%AF%E4%B8%8D%E6%98%AF%E5%BE%88%E6%83%B3%E5%90%8E%E7%AB%AF%E4%BC%A0%E7%BB%99%E6%88%91%E4%BB%AC%E7%9A%84%E6%8E%A5%E5%8F%A3%E3%80%82">http://127.0.0.1:3000?user=jspang&amp;age=18来进行访问。我们在网页中可以得到一串JSON字符串，这是不是很想后端传给我们的接口。</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;url&quot;</span>:<span class="string">&quot;/?user=jspang&amp;age=18&quot;</span>,<span class="string">&quot;req_query&quot;</span>:&#123;<span class="string">&quot;user&quot;</span>:<span class="string">&quot;jspang&quot;</span>,<span class="string">&quot;age&quot;</span>:<span class="string">&quot;18&quot;</span>&#125;,<span class="string">&quot;req_querystring&quot;</span>:<span class="string">&quot;user=jspang&amp;age=18&quot;</span>&#125;</span><br></pre></td></tr></table></figure><h4 id="直接从ctx中获取GET请求"><a href="#直接从ctx中获取GET请求" class="headerlink" title="直接从ctx中获取GET请求"></a>直接从ctx中获取GET请求</h4><p>除了在ctx.request中获取Get请求外，还可以直接在ctx中得到GET请求。ctx中也分为query和querystring。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line">app.use(<span class="keyword">async</span>(ctx)=&gt;&#123;</span><br><span class="line">    <span class="keyword">let</span> url =ctx.url;</span><br><span class="line">    <span class="comment">//从request中获取GET请求</span></span><br><span class="line">    <span class="keyword">let</span> request =ctx.request;</span><br><span class="line">    <span class="keyword">let</span> req_query = request.query;</span><br><span class="line">    <span class="keyword">let</span> req_querystring = request.querystring;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//从上下文中直接获取</span></span><br><span class="line">    <span class="keyword">let</span> ctx_query = ctx.query;</span><br><span class="line">    <span class="keyword">let</span> ctx_querystring = ctx.querystring;</span><br><span class="line">    ctx.body=&#123;</span><br><span class="line">        url,</span><br><span class="line">        req_query,</span><br><span class="line">        req_querystring,</span><br><span class="line">        ctx_query,</span><br><span class="line">        ctx_querystring</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;[demo] server is starting at port 3000&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="4-post请求"><a href="#4-post请求" class="headerlink" title="4.post请求"></a>4.post请求</h3><p>对于POST请求的处理，Koa2没有封装方便的获取参数的方法，需要通过解析上下文context中的原生node.js请求对象req来获取。</p><h4 id="获取Post请求的步骤："><a href="#获取Post请求的步骤：" class="headerlink" title="获取Post请求的步骤："></a><strong>获取Post请求的步骤：</strong></h4><ol><li>解析上下文ctx中的原生node.js对象req。——–字符串</li><li>将POST表单数据解析成query string-字符串.(例如:user=jspang&amp;age=18)</li><li>将字符串转换成JSON格式。</li></ol><p><strong>ctx.request和ctx.req的区别</strong></p><ul><li>ctx.request:是Koa2中context经过封装的请求对象，它用起来更直观和简单。</li><li>ctx.req:是context提供的node.js原生HTTP请求对象。这个虽然不那么直观，但是可以得到更多的内容，适合我们深度编程。</li></ul><p><strong>ctx.method 得到请求类型</strong></p><p>Koa2中提供了ctx.method属性，可以轻松的得到请求的类型，然后根据请求类型编写不同的相应方法，这在工作中非常常用。我们先来作个小例子，根据请求类型获得不同的页面内容。GET请求时得到表单填写页面，POST请求时，得到POST处理页面。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">const Koa &#x3D; require(&#39;koa&#39;);</span><br><span class="line">const app &#x3D; new Koa();</span><br><span class="line">app.use(async(ctx)&#x3D;&gt;&#123;</span><br><span class="line">    &#x2F;&#x2F;当请求时GET请求时，显示表单让用户填写</span><br><span class="line">    if(ctx.url&#x3D;&#x3D;&#x3D;&#39;&#x2F;&#39; &amp;&amp; ctx.method &#x3D;&#x3D;&#x3D; &#39;GET&#39;)&#123;</span><br><span class="line">        let html &#x3D;&#96;</span><br><span class="line">            &lt;h1&gt;Koa2 request post demo&lt;&#x2F;h1&gt;</span><br><span class="line">            &lt;form method&#x3D;&quot;POST&quot;  action&#x3D;&quot;&#x2F;&quot;&gt;</span><br><span class="line">                &lt;p&gt;userName&lt;&#x2F;p&gt;</span><br><span class="line">                &lt;input name&#x3D;&quot;userName&quot; &#x2F;&gt; &lt;br&#x2F;&gt;</span><br><span class="line">                &lt;p&gt;age&lt;&#x2F;p&gt;</span><br><span class="line">                &lt;input name&#x3D;&quot;age&quot; &#x2F;&gt; &lt;br&#x2F;&gt;</span><br><span class="line">                &lt;p&gt;webSite&lt;&#x2F;p&gt;</span><br><span class="line">                &lt;input name&#x3D;&#39;webSite&#39; &#x2F;&gt;&lt;br&#x2F;&gt;</span><br><span class="line">                &lt;button type&#x3D;&quot;submit&quot;&gt;submit&lt;&#x2F;button&gt;</span><br><span class="line">            &lt;&#x2F;form&gt;</span><br><span class="line">        &#96;;</span><br><span class="line">        ctx.body &#x3D;html;</span><br><span class="line">    &#x2F;&#x2F;当请求时POST请求时</span><br><span class="line">    &#125;else if(ctx.url&#x3D;&#x3D;&#x3D;&#39;&#x2F;&#39; &amp;&amp; ctx.method &#x3D;&#x3D;&#x3D; &#39;POST&#39;)&#123;</span><br><span class="line">        ctx.body&#x3D;&#39;接收到请求&#39;;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        &#x2F;&#x2F;其它请求显示404页面</span><br><span class="line">        ctx.body&#x3D;&#39;&lt;h1&gt;404!&lt;&#x2F;h1&gt;&#39;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(3000,()&#x3D;&gt;&#123;</span><br><span class="line">    console.log(&#39;[demo] server is starting at port 3000&#39;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>写好这段代码后你可以用node命令执行它，然后再浏览器中输入<a href="http://127.0.0.1:3000进行查看，第一次进入时给我们展现的是一个表单页面，我们点击提交后可以看到服务器接收到了我们的信息，但我们并没有做出任何处理。当我们输入一个其他的地址时，它会提示404错误。">http://127.0.0.1:3000进行查看，第一次进入时给我们展现的是一个表单页面，我们点击提交后可以看到服务器接收到了我们的信息，但我们并没有做出任何处理。当我们输入一个其他的地址时，它会提示404错误。</a></p><h3 id="5-koa-router"><a href="#5-koa-router" class="headerlink" title="5.koa-router"></a>5.koa-router</h3><blockquote><p>路由（Routing）是由一个 URI（或者叫路径）和一个特定的 HTTP 方法（GET、POST 等）组成的，涉及到应用如何响应客户端对某个网站节点的访问。</p><p>Koa中的路由和Express有所不同，在Express中直接引入Express就可以配置路由，但是在Koa中我们需要安装对应的koa-router路由模块来实现</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save koa-router</span><br></pre></td></tr></table></figure><p>基础的使用</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Koa = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> Router = <span class="built_in">require</span>(<span class="string">&#x27;koa-router&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">var</span> router = <span class="keyword">new</span> Router();</span><br><span class="line">router.get(<span class="string">&#x27;/&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">ctx,next</span>)</span>&#123;</span><br><span class="line">    ctx.body=<span class="string">&quot;Hello koa&quot;</span>;</span><br><span class="line">&#125;)</span><br><span class="line">router.get(<span class="string">&#x27;/news&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">ctx,next</span>)</span>&#123;</span><br><span class="line">    ctx.body = <span class="string">&quot;新闻page&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 启用路由</span></span><br><span class="line">app.use(router.routes);</span><br><span class="line"><span class="comment">// 遵循get请求方式</span></span><br><span class="line">app.use(router.allowedMethods());</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;starting at port 3000&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="6-koa-cookie"><a href="#6-koa-cookie" class="headerlink" title="6.koa-cookie"></a>6.koa-cookie</h3><p><strong>1、Koa中设置Cookie的值</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.cookies.set(name, value, [options])</span><br></pre></td></tr></table></figure><p><strong>通过 options 设置 cookie name 的 value :</strong></p><table><thead><tr><th>options名称</th><th>options值</th></tr></thead><tbody><tr><td>maxAge</td><td>一个数字表示从 Date.now() 得到的毫秒数</td></tr><tr><td>expires cookie</td><td>过期的 Date 数值</td></tr><tr><td>path cookie</td><td>路径, 默认是’/‘</td></tr><tr><td>domain cookie</td><td>域名</td></tr><tr><td>secure</td><td>安全 cookie 默认false，设置成true表示只有 https可以访问</td></tr><tr><td>httpOnly</td><td>是否只是服务器可访问 cookie, 默认是 true</td></tr><tr><td>overwrite</td><td>布尔值，表示是否覆盖以前设置的同名的 cookie (默认是 false)</td></tr><tr><td>Cookie</td><td>（不管路径或域）是否在设置此Cookie 时从 Set-Cookie 标头中过滤掉。</td></tr></tbody></table><p><strong>2、Koa中获取Cookie的值</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.cookies.get(<span class="string">&#x27;name&#x27;</span>);</span><br></pre></td></tr></table></figure><p><strong>3、Koa中设置中文Cookie</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> Buffer(<span class="string">&#x27;hello, world!&#x27;</span>).toString(<span class="string">&#x27;base64&#x27;</span>));<span class="comment">// 转换成base64字符串：aGVsbG8sIHdvcmxkIQ==</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> Buffer(<span class="string">&#x27;aGVsbG8sIHdvcmxkIQ==&#x27;</span>, <span class="string">&#x27;base64&#x27;</span>).toString());<span class="comment">// 还原base64字符串：hello, world!</span></span><br></pre></td></tr></table></figure><h3 id="7-koa-session"><a href="#7-koa-session" class="headerlink" title="7.koa-session"></a>7.koa-session</h3><p><strong>1.安装</strong> <strong>koa-session</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install koa-session --save</span><br></pre></td></tr></table></figure><p><strong>2.引入express-session</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">&#x27;koa-session&#x27;</span>);</span><br></pre></td></tr></table></figure><p><strong>3.设置官方文档提供的中间件</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">app.keys = [<span class="string">&#x27;some secret hurr&#x27;</span>];</span><br><span class="line"><span class="keyword">const</span> CONFIG = &#123;</span><br><span class="line">   key: <span class="string">&#x27;koa:sess&#x27;</span>,   <span class="comment">//cookie key (default is koa:sess)</span></span><br><span class="line">   maxAge: <span class="number">86400000</span>,  <span class="comment">// cookie的过期时间 maxAge in ms (default is 1 days)</span></span><br><span class="line">   overwrite: <span class="literal">true</span>,  <span class="comment">//是否可以overwrite    (默认default true)</span></span><br><span class="line">   httpOnly: <span class="literal">true</span>, <span class="comment">//cookie是否只有服务器端可以访问 httpOnly or not (default true)</span></span><br><span class="line">   signed: <span class="literal">true</span>,   <span class="comment">//签名默认true</span></span><br><span class="line">   rolling: <span class="literal">false</span>,  <span class="comment">//在每次请求时强行设置cookie，这将重置cookie过期时间（默认：false）</span></span><br><span class="line">   renew: <span class="literal">false</span>,  <span class="comment">//(boolean) renew session when session is nearly expired,</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 启用</span></span><br><span class="line">app.use(session(CONFIG, app));</span><br></pre></td></tr></table></figure><p><strong>4.使用</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">设置值 ctx.session.username = <span class="string">&quot;张三&quot;</span>;</span><br><span class="line">     获取值 ctx.session.username</span><br></pre></td></tr></table></figure><h3 id="8-koa模板初始（ejs）"><a href="#8-koa模板初始（ejs）" class="headerlink" title="8.koa模板初始（ejs）"></a>8.koa模板初始（ejs）</h3><p>开发中不可能把所有的html代码全部写在JS里，这显然不现实，也没办法完成大型web开发。必须借用模板机制来帮助我们开发。</p><p><strong>1.安装中间件</strong></p><p>在koa2中使用模板机制必须依靠中间件，我们这里选择koa-views中间件，先使用npm来进行安装。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install --save koa-views</span><br></pre></td></tr></table></figure><blockquote><p>注意是koa-views 而不是 koa-view</p></blockquote><p><strong>2.安装ejs模板引擎</strong></p><p>ejs是个著名并强大的模板引擎，可以单独安装。很多开源软件都采用了ejs模板引擎。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install --save ejs</span><br></pre></td></tr></table></figure><p><strong>3.编写模板</strong></p><p>安装好ejs模板引擎后，就可以编写模板了，为了模板统一管理，我们新建一个view的文件夹，并在它下面新建index.ejs文件。<code>注意后缀名是ejs</code></p><p>views/index.ejs</p><p>在文件中使用<code>&lt;%= 变量名 %&gt;</code>进行赋值。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;&lt;%= title %&gt;&lt;/title&gt;http://jspang.com/wp-admin/post.php?post=2760&amp;action=edit#</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;&lt;%= title %&gt;&lt;/h1&gt;</span><br><span class="line">    &lt;p&gt;EJS Welcome to &lt;%= title %&gt;&lt;/p&gt;</span><br><span class="line">&lt;/body</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><strong>4.编写koa文件</strong></p><p>在js文件中配置并渲染</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>)</span><br><span class="line"><span class="comment">//首先引入 koa-views</span></span><br><span class="line"><span class="keyword">const</span> views = <span class="built_in">require</span>(<span class="string">&#x27;koa-views&#x27;</span>)</span><br><span class="line"><span class="comment">//引入node自带路径管理</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载模板引擎，在views中有两个参数：参数1:路径，参数2：extension: &#x27;ejs&#x27;</span></span><br><span class="line">app.use(views(path.join(__dirname, <span class="string">&#x27;./view&#x27;</span>), &#123;</span><br><span class="line">  extension: <span class="string">&#x27;ejs&#x27;</span></span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line">app.use( <span class="keyword">async</span> ( ctx ) =&gt; &#123;</span><br><span class="line">  <span class="comment">//命名变量</span></span><br><span class="line">  <span class="keyword">let</span> title = <span class="string">&#x27;hello koa2&#x27;</span></span><br><span class="line">  <span class="comment">//渲染index.ejs文件，并把变量传过去</span></span><br><span class="line">  <span class="keyword">await</span> ctx.render(<span class="string">&#x27;index&#x27;</span> , &#123;title&#125; )</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;[demo] server is starting at port 3000&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>底层实现</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http=<span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> express=<span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> app=express();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> tem=&#123;</span><br><span class="line">    message:<span class="string">&quot;我是中间部分&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//创建服务器</span></span><br><span class="line">http.createServer(app).listen(<span class="number">3000</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;Server is listening port 3000&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//挂载静态资源处理中间件</span></span><br><span class="line">app.use(express.static(__dirname+<span class="string">&quot;/public&quot;</span>));</span><br><span class="line"><span class="comment">//设置模板视图的目录</span></span><br><span class="line">app.set(<span class="string">&quot;views&quot;</span>,<span class="string">&quot;./public/views&quot;</span>);</span><br><span class="line"><span class="comment">//设置是否启用视图编译缓存，启用将加快服务器执行效率</span></span><br><span class="line">app.set(<span class="string">&quot;view cache&quot;</span>,<span class="literal">true</span>);</span><br><span class="line"><span class="comment">//设置模板引擎的格式即运用何种模板引擎</span></span><br><span class="line">app.set(<span class="string">&quot;view engine&quot;</span>,<span class="string">&quot;ejs&quot;</span>);</span><br><span class="line"><span class="comment">//设置路由</span></span><br><span class="line">app.get(<span class="string">&quot;/ejs&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">    res.render(<span class="string">&quot;ejs1&quot;</span>,&#123;<span class="attr">title</span>:tem.message&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>EJS常用标签</p><ul><li>&lt;% %&gt;流程控制标签</li><li>&lt;%= %&gt;输出标签（原文输出HTML标签）</li><li>&lt;%- %&gt;输出标签（HTML会被浏览器解析）</li><li>&lt;%# %&gt;注释标签</li><li>% 对标记进行转义</li><li>-%&gt;去掉没用的空格</li></ul><p>函数</p><blockquote><p>render(src,data,[option]) 函数</p><p>option 为配置项</p></blockquote><h3 id="9-koa-static静态资源中间件"><a href="#9-koa-static静态资源中间件" class="headerlink" title="9.koa-static静态资源中间件"></a>9.koa-static静态资源中间件</h3><blockquote><p>koa-static主要是用于访问静态资源</p></blockquote><p>一个http请求访问web服务静态资源，一般响应结果有三种情况</p><ul><li>访问文本，例如js，css，png，jpg，gif</li><li>访问静态目录</li><li>找不到资源，抛出404错误</li></ul><p><strong>Koa 中koa-static中间件的使用</strong></p><p><strong>1、安装 koa-static</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save koa-static</span><br></pre></td></tr></table></figure><p><strong>2、引入配置中间件</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">static</span> = <span class="built_in">require</span>(<span class="string">&#x27;koa-static&#x27;</span>); </span><br><span class="line">app.use(<span class="keyword">static</span>(</span><br><span class="line">    path.join( __dirname,  <span class="string">&#x27;public&#x27;</span>)  <span class="comment">//public即是静态资源存放的地方。使用绝对位置</span></span><br><span class="line">)) </span><br></pre></td></tr></table></figure><p><strong>3、koa中间件即可解析public静态资源</strong></p><h3 id="10-koa-bodyparser"><a href="#10-koa-bodyparser" class="headerlink" title="10.koa-bodyparser"></a>10.koa-bodyparser</h3><blockquote><p>koa-bodyparser用于 Koa post提交数据的一个模块</p></blockquote><p>原理：对于POST请求的处理，koa-bodyparser中间件可以把koa2上下文（ctx）的formData数据解析到ctx.request.body中。</p><p><strong>1、安装 koa-bodyparser</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save koa-bodyparser</span><br></pre></td></tr></table></figure><p><strong>2、安装</strong> <strong>koa-bodyparser</strong> <strong>引入配置中间件</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Koa = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;koa-bodyparser&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line">app.use(bodyParser());</span><br><span class="line"> </span><br><span class="line">app.use(<span class="keyword">async</span> ctx =&gt; &#123; </span><br><span class="line">  ctx.body = ctx.request.body;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><strong>3、通过**</strong>ctx.request.body 获取post提交的数据**</p><ul><li>ctx.request.body 获取post提交的数据</li></ul><h3 id="生词表"><a href="#生词表" class="headerlink" title="生词表"></a>生词表</h3><p>router.prefix(‘/users’) 设置父路径。</p><p>ctx: res,req的合体</p><p>ctx.body = {} 返回内容</p><p>next()下一个中间键</p><h2 id="Session和Cookie"><a href="#Session和Cookie" class="headerlink" title="Session和Cookie"></a>Session和Cookie</h2><h3 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h3><p><strong>介绍</strong></p><p>session是另一种记录客户状态的机制，不同的是Cookie保存在客户端浏览器中，而session保存在服务器上。</p><p><strong>Session的工作流程</strong></p><p>当浏览器访问服务器并发送第一次请求时，服务器端会创建一个session对象，生成一个类似于key,value的键值对， 然后将key(cookie)返回到浏览器(客户)端，浏览器下次再访问时，携带key(cookie)，找到对应的session(value)。 客户的信息都保存在session中</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> CONFIG = &#123;</span><br><span class="line">   key: <span class="string">&#x27;koa:sess&#x27;</span>,   <span class="comment">//cookie key (default is koa:sess)</span></span><br><span class="line">   maxAge: <span class="number">86400000</span>,  <span class="comment">// cookie的过期时间 maxAge in ms (default is 1 days)</span></span><br><span class="line">   overwrite: <span class="literal">true</span>,  <span class="comment">//是否可以overwrite    (默认default true)</span></span><br><span class="line">   httpOnly: <span class="literal">true</span>, <span class="comment">//cookie是否只有服务器端可以访问 httpOnly or not (default true)</span></span><br><span class="line">   signed: <span class="literal">true</span>,   <span class="comment">//签名默认true</span></span><br><span class="line">   rolling: <span class="literal">false</span>,  <span class="comment">//在每次请求时强行设置cookie，这将重置cookie过期时间（默认：false）</span></span><br><span class="line">   renew: <span class="literal">false</span>,  <span class="comment">//(boolean) renew session when session is nearly expired,</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>在node中使用Session</p><ul><li><p>安装:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install express-session</span><br></pre></td></tr></table></figure></li><li><p>配置：<em>注意：一定要在app.use(router)之前</em></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app.use(session(&#123;</span><br><span class="line">    secret: <span class="string">&#x27;xww&#x27;</span>, <span class="comment">//配置加密字符串   为了增加安全性</span></span><br><span class="line">    resave: <span class="literal">false</span>,</span><br><span class="line">    saveUninitialized: <span class="literal">true</span> <span class="comment">//无论你是否使用Session，我们都默认会给你一把钥匙 值为false时不会给钥匙</span></span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure></li><li><p>使用：</p><ul><li><p>配置好插件之后，通过req.session来访问和设置Session成员</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//添加Session数据：</span></span><br><span class="line">req.session.foo=<span class="string">&#x27;bar&#x27;</span></span><br><span class="line"><span class="comment">//访问Session数据：</span></span><br><span class="line">req.session.foo</span><br></pre></td></tr></table></figure><blockquote><p>默认session数据是内存存储的，服务器一旦重启，真正的生产环境会把session进行持久化存储。</p></blockquote></li></ul></li></ul><h3 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h3><p><strong>COOKIE</strong> <strong>简介</strong></p><p>cookie 是存储于访问者的计算机中的变量。可以让我们用同一个浏览器访问同一个域名的时候共享数据。</p><p>● HTTP是无状态协议。简单地说，当你浏览了一个页面，然后转到同一个网站的另一个页面，服务器无法认识到这是同一个浏览器在访问同一个网站。每一次的访问，都是没有任何关系的。</p><p>● Cookie是一个简单到爆的想法：当访问一个页面的时候，服务器在下行HTTP报文中，命令浏览器存储一个字符串; 浏览器再访问同一个域的时候，将把这个字符串携带到上行HTTP请求中。第一次访问一个服务器，不可能携带cookie。 必须是服务器得到这次请求，在下行响应报头中，携带cookie信息，此后每一次浏览器往这个服务器发出的请求，都会携带这个cookie。</p><p><strong>选项：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">maxAge              一个数字表示从 <span class="built_in">Date</span>.now() 得到的毫秒数</span><br><span class="line">expires cookie      过期的 <span class="built_in">Date</span></span><br><span class="line">path cookie         路径, 默认是<span class="string">&#x27;/&#x27;</span></span><br><span class="line">domain cookie       域名</span><br><span class="line">secure             安全 cookie   默认<span class="literal">false</span>，设置成<span class="literal">true</span>表示只有 https可以访问</span><br><span class="line">httpOnly           是否只是服务器可访问 cookie, 默认是 <span class="literal">true</span></span><br><span class="line">overwrite          一个布尔值，表示是否覆盖以前设置的同名的 cookie (默认是 <span class="literal">false</span>). 如果是 <span class="literal">true</span>, 在同一个请求中设置相同名称的所有 Cookie（不管路径或域）是否在设置此Cookie 时从 <span class="built_in">Set</span>-Cookie 标头中过滤掉。</span><br></pre></td></tr></table></figure><p>cookie与session<strong>的区别：</strong></p><ol><li>cookie数据存放在客户的浏览器上，session数据放在服务器上。</li><li>cookie不是很安全，别人可以分析存放在本地的COOKIE并进行COOKIE欺骗<br>考虑到安全应当使用session。</li><li>session会在一定时间内保存在服务器上。当访问增多，会比较占用你服务器的性能<br>考虑到减轻服务器性能方面，应当使用COOKIE。</li><li>单个cookie保存的数据不能超过4K，很多浏览器都限制一个站点最多保存20个cookie。</li></ol><h2 id="dirname-和-filename"><a href="#dirname-和-filename" class="headerlink" title="__dirname 和 __filename"></a>__dirname 和 __filename</h2><ul><li><p><strong>动态的</strong> 获取当前文件或者文件所处目录的<strong>绝对路径</strong></p></li><li><p>用来解决文件操作路劲的相对路径问题</p></li><li><p>因为在文件操作中，相对路径相对于执行 <code>node</code> 命令所处的目录</p></li><li><p>所以为了尽量避免这个问题，都建议文件操作的相对路劲都转为：<strong>动态的绝对路径</strong></p></li><li><p><strong>方式</strong>：<code>path.join(__dirname, &#39;文件名&#39;)</code></p><blockquote><p>在模块中的相对路径和文件操作路径不同，注重文件操作中文件的动态获取。</p></blockquote></li></ul><h2 id="node中的日志"><a href="#node中的日志" class="headerlink" title="node中的日志"></a>node中的日志</h2><h3 id="1-概念"><a href="#1-概念" class="headerlink" title="1.概念"></a>1.概念</h3><p>日志：用于记录上线之后的一些信息，因为在上线之后可能会产生bug，可以通过查看日志来查询bug。也可以通过查看日志来查询每天的访问的各种信息，例如：访问的浏览器 系统等。那么对于日志的<strong>开发需要处理那些方面</strong>呢，总结概述为下面的三个方面：</p><p><strong>1.nodejs文件操作，nodejs stream<br>2.日志功能开发和使用<br>3.日志文件拆分，日志内容分析</strong></p><p>为何<strong>日志存在文件之中</strong></p><p><strong>1.文件中的内容可以转到各个服务器上去计算运行，不需要配置。<br>2.日志中的内容只是一条一条的信息，本身对内存性能上的要求并不是太高<br>3.不存在mysql中的原因是，mysql是硬盘数据库，里面存放的是各表之间的某种关联关系，如果要将日志中内容放在其他服务器进行分析，使用MySQL则需要在服务器中对mysql进行配置以及保证各服务器上的数据库必须保证一致<br>4.不存在redis当中是因为redis是内存数据库，日志会随着时间的推移而变得越来越多因此，如果使用redis是非常的不划算的。因为redis中的内存是非常宝贵的，日志对于性能的要求不太高，因此不需要。</strong></p><h3 id="2-日志的类型"><a href="#2-日志的类型" class="headerlink" title="2.日志的类型"></a>2.日志的类型</h3><ol><li>访问日志 <code>access log</code> （server端最重要的日志）</li><li>自定义日志（包括自定义事件、错误记录等）</li></ol><h3 id="3-日志与流的使用"><a href="#3-日志与流的使用" class="headerlink" title="3.日志与流的使用"></a>3.日志与流的使用</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 写日志</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">writeLog</span>(<span class="params">writeStream, log</span>) </span>&#123;</span><br><span class="line">    writeStream.write(log + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个写日志流</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createWrite</span>(<span class="params">flieName</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> filepath = path.join(__dirname, <span class="string">&#x27;/logs&#x27;</span>, flieName)</span><br><span class="line">    <span class="keyword">let</span> writeStream = fs.createWriteStream(filepath, &#123;</span><br><span class="line">        flags: <span class="string">&#x27;a&#x27;</span>,</span><br><span class="line">        encoding: <span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> writeStream</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 写访问日志</span></span><br><span class="line"><span class="keyword">const</span> accessWriteStream = createWrite(<span class="string">&#x27;access.log&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">access</span>(<span class="params">log</span>) </span>&#123;</span><br><span class="line">    writeLog(accessWriteStream, log)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//导出模块</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    access</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-日志拆分"><a href="#4-日志拆分" class="headerlink" title="4.日志拆分"></a>4.日志拆分</h3><blockquote><p>由于日志内容会慢慢积累，放在一个文件中不好处理，所以对日志文件要进行拆分处理。一般按时间划分日志文件。</p></blockquote><p>实现方式：linux的crontab命令，定时任务</p><p>1.设置定时任务，格式：<code>* * * * * command</code></p><ul><li>第一个<code>*</code>代表分钟</li><li>第二个<code>*</code>代表分小时</li><li>第三个<code>*</code>代表是多少号</li><li>第四个<code>*</code>代表是月份</li><li>第五个<code>*</code>代表星期几</li><li>command linux的命令</li></ul><p>2.将access.log拷贝并且重新命名为<code>2019-02-10.access.log</code>的格式。</p><p>3.清空access.log文件，继续积累日志。</p><h3 id="5-日志分析"><a href="#5-日志分析" class="headerlink" title="5.日志分析"></a>5.日志分析</h3><p>何为日志分析呢？ 例如 在<code>access.log</code>日志，分析chrome的占比</p><ul><li><p>日志是按照行存储的，一行就是一条日志。</p></li><li><p>使用nodejs的readline可以读取文件一整行的内容（使用Stream,效率更高）。</p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> readline = <span class="built_in">require</span>(<span class="string">&#x27;readline&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 文件名</span></span><br><span class="line"><span class="keyword">const</span> flieName = path.join(__dirname, <span class="string">&#x27;/logs/access.log&#x27;</span>)</span><br><span class="line">    <span class="comment">// 创建 read Stream</span></span><br><span class="line"><span class="keyword">const</span> readStream = fs.createReadStream(flieName)</span><br><span class="line">    <span class="comment">// 创建 readline 对象</span></span><br><span class="line"><span class="keyword">const</span> rl = readline.createInterface(&#123;</span><br><span class="line">    input: readStream</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> chromeNum = <span class="number">0</span></span><br><span class="line"><span class="keyword">let</span> sum = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 逐行读取</span></span><br><span class="line">rl.on(<span class="string">&#x27;line&#x27;</span>, <span class="function">(<span class="params">lineDate</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!lineDate) <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">let</span> arr = lineDate.split(<span class="string">&#x27;--&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> (arr[<span class="number">2</span>] &amp;&amp; arr[<span class="number">2</span>].indexOf(<span class="string">&#x27;Chrome&#x27;</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            chromeNum++</span><br><span class="line">        &#125;</span><br><span class="line">        sum++</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 监听读取完成</span></span><br><span class="line">rl.on(<span class="string">&#x27;close&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;chrome 占比：&#x27;</span> + (chromeNum / sum).toFixed(<span class="number">4</span>) * <span class="number">100</span> + <span class="string">&#x27;%&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="6-插件morgan"><a href="#6-插件morgan" class="headerlink" title="6.插件morgan"></a>6.插件morgan</h3><h4 id="安装："><a href="#安装：" class="headerlink" title="安装："></a>安装：</h4><p><code>npm i morgan --save</code></p><h4 id="参数："><a href="#参数：" class="headerlink" title="参数："></a>参数：</h4><p>​ logger(format,options)</p><h4 id="format-（string-function）打印方式，可以是预定义打印方式的名称，或格式化字符串，或格式化入口的回调方法"><a href="#format-（string-function）打印方式，可以是预定义打印方式的名称，或格式化字符串，或格式化入口的回调方法" class="headerlink" title="format:（string/function）打印方式，可以是预定义打印方式的名称，或格式化字符串，或格式化入口的回调方法"></a>format:（string/function）打印方式，可以是预定义打印方式的名称，或格式化字符串，或格式化入口的回调方法</h4><ul><li>使用预定义打印方式</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">morgan(<span class="string">&#x27;tiny&#x27;</span>);</span><br></pre></td></tr></table></figure><ul><li>使用格式化字符串</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">morgan(<span class="string">&#x27;:method :url :status :res[content-length] - :response-time ms&#x27;</span>)</span><br></pre></td></tr></table></figure><ul><li>使用格式化回调方法</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">morgan(function (tokens, req, res) &#123;</span><br><span class="line">  return [</span><br><span class="line">    tokens.method(req, res),</span><br><span class="line">    tokens.url(req, res),</span><br><span class="line">    tokens.status(req, res),</span><br><span class="line">    tokens.res(req, res, &#39;content-length&#39;), &#39;-&#39;,</span><br><span class="line">    tokens[&#39;response-time&#39;](req, res), &#39;ms&#39;</span><br><span class="line">  ].join(&#39; &#39;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="options：（object）日志打印参数配置"><a href="#options：（object）日志打印参数配置" class="headerlink" title="options：（object）日志打印参数配置"></a>options：（object）日志打印参数配置</h4><ul><li>immediate: 请求到达时打印</li><li>skip: 设置忽略打印的日志</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">morgan(<span class="string">&#x27;combined&#x27;</span>, &#123;</span><br><span class="line">  skip: <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123; <span class="keyword">return</span> res.statusCode &lt; <span class="number">400</span> &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>stream: 输出流，默认控制台输出</li><li>Predefined Formats: 预定义打印格式</li></ul><h4 id="预定义格式"><a href="#预定义格式" class="headerlink" title="预定义格式"></a><strong>预定义格式</strong></h4><p>combined: 标准Apache组合日志输出</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:remote-addr - :remote-user [:date[clf]] &quot;:method :url HTTP&#x2F;:http-version&quot; :status :res[content-length] &quot;:referrer&quot; &quot;:user-agent&quot;</span><br><span class="line">1</span><br></pre></td></tr></table></figure><p>common: 标准Apache公共日志输出</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:remote-addr - :remote-user [:date[clf]] <span class="string">&quot;:method :url HTTP/:http-version&quot;</span> :status :res[content-length]</span><br></pre></td></tr></table></figure><p>dev: 根据返回的状态码彩色输出日志</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:method :url :status :response-time ms - :res[content-length]</span><br></pre></td></tr></table></figure><p>short: 简洁输出，带响应时间</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:remote-addr :remote-user :method :url HTTP/:http-version :status :res[content-length] - :response-time ms</span><br></pre></td></tr></table></figure><p>tiny: 控制台输出</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:method :url :status :res[content-length] - :response-time ms</span><br></pre></td></tr></table></figure><p>token 自定义格式输出</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">morgan.token(<span class="string">&#x27;type&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123; <span class="keyword">return</span> req.headers[<span class="string">&#x27;content-type&#x27;</span>] &#125;)</span><br></pre></td></tr></table></figure><h4 id="设置项"><a href="#设置项" class="headerlink" title="设置项"></a>设置项</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">:date[format] 日期格式</span><br><span class="line"></span><br><span class="line">+ clf: “10&#x2F;Oct&#x2F;2000:13:55:36 +0000”</span><br><span class="line">+ iso: “2000-10-10T13:55:36.000Z”</span><br><span class="line">+ web “Tue, 10 Oct 2000 13:55:36 GMT”</span><br><span class="line"></span><br><span class="line">:http-version http版本</span><br><span class="line"></span><br><span class="line">:method 请求类型</span><br><span class="line"></span><br><span class="line">:referrer 请求的引用头</span><br><span class="line"></span><br><span class="line">:remote-addr 远程请求地址</span><br><span class="line"></span><br><span class="line">:remote-user 远程用户</span><br><span class="line"></span><br><span class="line">:req[header] 请求头信息 &#39;-&#39;分隔</span><br><span class="line"></span><br><span class="line">:response-time[digits] 请求响应时间</span><br><span class="line"></span><br><span class="line">:status 响应状态码</span><br><span class="line"></span><br><span class="line">:url 访问地址</span><br><span class="line"></span><br><span class="line">:user-agent 浏览器信息</span><br></pre></td></tr></table></figure><p>生产配置</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> logger = <span class="built_in">require</span>(<span class="string">&#x27;morgan&#x27;</span>)</span><br><span class="line"><span class="comment">// 配置morgan,输出日志</span></span><br><span class="line"><span class="comment">// 环境</span></span><br><span class="line"><span class="keyword">const</span> ENV = process.env.NODE_ENV;</span><br><span class="line"><span class="keyword">if</span> (ENV !== <span class="string">&quot;production&quot;</span>) &#123;</span><br><span class="line">    app.use(logger(<span class="string">&#x27;dev&#x27;</span>))</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> fileName = path.join(__dirname, <span class="string">&#x27;./logs/access.log&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> writeStream = fs.createWriteStream(fileName, &#123;</span><br><span class="line">        flags: <span class="string">&quot;a&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    app.use(logger(<span class="string">&#x27;combined&#x27;</span>, &#123;</span><br><span class="line">        stream: writeStream</span><br><span class="line">    &#125;))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="node流（stream）"><a href="#node流（stream）" class="headerlink" title="node流（stream）"></a>node流（stream）</h2><p>对 于之前的<strong>I/O读取有以下的几个缺点</strong>：</p><ol><li><p>IO包括 “网络IO”和“文件IO” 两者都有一个共性在输入与读取文件的时候，都是将IO操作中的数据读取完之后，才进行下一步的操作，很显然这样的处理方式是非常的不可取的。</p></li><li><p>相比于CPU计算和内存的读写，IO操作的速度就非常的慢了。</p></li></ol><p>因此针对于上面文件的不足，在此就引入<strong>stream</strong>流的思想来进行优化。<strong>stream由三个部分组成 resource pipe deststream的思想就是缓冲思想，将文件初始中的数据先通过pipe给dest，然后就这样一直传送数据，最后直至到文件传输完成，即可完成文件传送过程，这也就是去提高IO操作效率的方法</strong></p><ul><li>标准的输入与输出通过process来进行管理process.stdin.pipe(process.stdout)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//将req  res以stream的方式连接</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(req.method === <span class="string">&#x27;POST&#x27;</span>)&#123;</span><br><span class="line">        req.pipe(res);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;) </span><br><span class="line">server.listen(<span class="number">8000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用stream进行文件的copy,实现部分的代码如下：</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fileName1 = path.resolve(__dirname, <span class="string">&#x27;data.txt&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fileName2 = path.resolve(__dirname, <span class="string">&#x27;data-bak.txt&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建一个读文件与一个写文件</span></span><br><span class="line"><span class="keyword">const</span> readStream = fs.createReadStream(fileName1);</span><br><span class="line"><span class="keyword">const</span> writeStream = fs.createWriteStream(fileName2);</span><br><span class="line"></span><br><span class="line">readStream.pipe(writeStream);</span><br><span class="line"></span><br><span class="line">readStream.on(<span class="string">&#x27;data&#x27;</span> , <span class="function"><span class="params">chunk</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(chunk.toString());</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">readStream.on(<span class="string">&#x27;end&#x27;</span>,<span class="function">() =&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;copy done&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//将文件中的内容读入，并通过res返回，具体的实现代码如下</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fileName1 = path.resolve(__dirname, <span class="string">&#x27;data.txt&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> readStream = fs.createReadStream(fileName1)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(req.method === <span class="string">&#x27;GET&#x27;</span>)&#123;</span><br><span class="line">        readStream.pipe(res);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">8000</span>);</span><br></pre></td></tr></table></figure><blockquote><p>fs,createWriteStream(filename,[option]) // 创建一个容器，用来放流出容器</p></blockquote><h2 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h2><p>几种常见的安全问题，通过web server 层做一些预防</p><ul><li><p>sql 注入：窃取数据库内容</p><ul><li>使用escape,防止sql注入。</li><li>对敏感变量进行过滤—&gt; escape(username)</li></ul></li><li><p>XSS 攻击：窃取前端的 cookie 内容</p><ul><li>安装xss工具<code>npm install xss --sava</code></li><li>引入xss</li><li>将敏感变量用xss()函数包裹字符化。</li></ul></li><li><p>密码加密：保障用户信息安全</p><ul><li>使用node内部提供的加密库<code>crypto</code></li><li>自定义一个密钥（string）</li><li>使用MD5进行加密</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>) <span class="comment">// 加密的库</span></span><br><span class="line"><span class="comment">// 先制作一个密钥</span></span><br><span class="line"><span class="keyword">const</span> SECRET_KEY = <span class="string">&#x27;XwW_2037.&#x27;</span></span><br><span class="line"><span class="comment">// md5 加密</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">md5</span>(<span class="params">content</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> md5 = crypto.createHash(<span class="string">&#x27;md5&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> md5.update(content).digest(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 加密函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">genPassword</span>(<span class="params">password</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> str = <span class="string">`password = <span class="subst">$&#123;password&#125;</span>&amp;key = <span class="subst">$&#123;SECRET_KEY&#125;</span>`</span></span><br><span class="line">    <span class="keyword">return</span> md5(str)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(genPassword(<span class="number">123</span>))  <span class="comment">// 559ef855497b5b7718f2c84a07cfe8a7</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="PM2"><a href="#PM2" class="headerlink" title="PM2"></a>PM2</h2><blockquote><p>PM2是node进程管理工具，可以利用它来简化很多node应用管理的繁琐任务，如性能监控、自动重启、负载均衡等，而且使用非常简单。</p></blockquote><h3 id="安装：-1"><a href="#安装：-1" class="headerlink" title="安装："></a>安装：</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 全局安装</span><br><span class="line">npm i -g pm2</span><br></pre></td></tr></table></figure><p>安装完成后会自动创建目录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$HOME&#x2F;.pm2   will contain all PM2 related files</span><br><span class="line">$HOME&#x2F;.pm2&#x2F;logs   will contain all applications logs</span><br><span class="line">$HOME&#x2F;.pm2&#x2F;pids   will contain all applications pids</span><br><span class="line">$HOME&#x2F;.pm2&#x2F;pm2.log   PM2 logs</span><br><span class="line">$HOME&#x2F;.pm2&#x2F;pm2.pid   PM2 pid</span><br><span class="line">$HOME&#x2F;.pm2&#x2F;rpc.sock    Socket file for remote commands</span><br><span class="line">$HOME&#x2F;.pm2&#x2F;pub.sock  Socket file for publishable events</span><br><span class="line">$HOME&#x2F;.pm2&#x2F;conf.js     PM2 Configuration</span><br></pre></td></tr></table></figure><h3 id="常用命令："><a href="#常用命令：" class="headerlink" title="常用命令："></a>常用命令：</h3><h5 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h5><p>参数说明：</p><ul><li><code>--watch</code>：监听应用目录的变化，一旦发生变化，自动重启。如果要精确监听、不见听的目录，最好通过配置文件。</li><li><code>-i --instances</code>：启用多少个实例，可用于负载均衡。如果<code>-i 0</code>或者<code>-i max</code>，则根据当前机器核数确定实例数目。</li><li><code>--ignore-watch</code>：排除监听的目录/文件，可以是特定的文件名，也可以是正则。比如<code>--ignore-watch=&quot;test node_modules &quot;some scripts&quot;&quot;</code></li><li><code>-n --name</code>：应用的名称。查看应用信息的时候可以用到。</li><li><code>-o --output &lt;path&gt;</code>：标准输出日志文件的路径。</li><li><code>-e --error &lt;path&gt;</code>：错误输出日志文件的路径。</li><li><code>--interpreter &lt;interpreter&gt;</code>：the interpreter pm2 should use for executing app (bash, python…)。比如你用的coffee script来编写应用。</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ npm install pm2 -g     # 命令行安装 pm2 </span><br><span class="line">$ pm2 start app.js -i 4  # 后台运行pm2，启动4个app.js </span><br><span class="line">                         # 也可以把&#x27;max&#x27; 参数传递给 start</span><br><span class="line">                         # 正确的进程数目依赖于Cpu的核心数目</span><br><span class="line">$ pm2 start app.js --name my-api # 命名进程</span><br><span class="line">$ pm2 list               # 显示所有进程状态</span><br><span class="line">$ pm2 monit              # 监视所有进程</span><br><span class="line">$ pm2 logs               # 显示所有进程日志</span><br><span class="line">$ pm2 stop all           # 停止所有进程</span><br><span class="line">$ pm2 restart all        # 重启所有进程</span><br><span class="line">$ pm2 reload all         # 0 秒停机重载进程 (用于 NETWORKED 进程)</span><br><span class="line">$ pm2 stop 0             # 停止指定的进程</span><br><span class="line">$ pm2 restart 0          # 重启指定的进程</span><br><span class="line">$ pm2 startup            # 产生 init 脚本 保持进程活着</span><br><span class="line">$ pm2 web                # 运行健壮的 computer API endpoint (http://localhost:9615)</span><br><span class="line">$ pm2 delete 0           # 杀死指定的进程</span><br><span class="line">$ pm2 delete all         # 杀死全部进程</span><br></pre></td></tr></table></figure><p>完整命令行参数列表：<a target="_blank" rel="noopener" href="http://pm2.keymetrics.io/docs/usage/quick-start/#options">地址</a></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 <span class="built_in">start</span> app.js -<span class="literal">-watch</span> <span class="literal">-i</span> <span class="number">2</span></span><br></pre></td></tr></table></figure><h5 id="重启"><a href="#重启" class="headerlink" title="重启"></a>重启</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 restart app.js</span><br></pre></td></tr></table></figure><h5 id="停止"><a href="#停止" class="headerlink" title="停止"></a>停止</h5><p>停止特定的应用。可以先通过<code>pm2 list</code>获取应用的名字（–name指定的）或者进程id。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 stop app_name|app_id</span><br></pre></td></tr></table></figure><p>如果要停止所有应用，可以</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 stop all</span><br></pre></td></tr></table></figure><h5 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h5><p>类似<code>pm2 stop</code>，如下</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pm2 stop app_name|app_id</span><br><span class="line">pm2 stop all</span><br></pre></td></tr></table></figure><h5 id="查看进程状态"><a href="#查看进程状态" class="headerlink" title="查看进程状态"></a>查看进程状态</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 list</span><br></pre></td></tr></table></figure><h5 id="查看某个进程的信息"><a href="#查看某个进程的信息" class="headerlink" title="查看某个进程的信息"></a>查看某个进程的信息</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">iZ94wb7tioqZ</span> <span class="type">pids</span>]<span class="comment"># pm2 describe 0</span></span><br><span class="line">Describing <span class="keyword">process</span> with id <span class="number">0</span> - name oc<span class="literal">-server</span></span><br><span class="line">┌───────────────────┬──────────────────────────────────────────────────────────────┐</span><br><span class="line">│ status            │ online                                                       │</span><br><span class="line">│ name              │ oc<span class="literal">-server</span>                                                    │</span><br><span class="line">│ id                │ <span class="number">0</span>                                                            │</span><br><span class="line">│ path              │ /<span class="keyword">data</span>/file/qiquan/over_the_counter/server/bin/www            │</span><br><span class="line">│ args              │                                                              │</span><br><span class="line">│ exec cwd          │ /<span class="keyword">data</span>/file/qiquan/over_the_counter/server                    │</span><br><span class="line">│ error log path    │ /<span class="keyword">data</span>/file/qiquan/over_the_counter/server/logs/app<span class="literal">-err</span><span class="literal">-0</span>.log │</span><br><span class="line">│ out log path      │ /<span class="keyword">data</span>/file/qiquan/over_the_counter/server/logs/app<span class="literal">-out</span><span class="literal">-0</span>.log │</span><br><span class="line">│ pid path          │ /root/.pm2/pids/oc<span class="literal">-server</span><span class="literal">-0</span>.pid                              │</span><br><span class="line">│ mode              │ fork_mode                                                    │</span><br><span class="line">│ node v8 arguments │                                                              │</span><br><span class="line">│ watch &amp; reload    │                                                             │</span><br><span class="line">│ interpreter       │ node                                                         │</span><br><span class="line">│ restarts          │ <span class="number">293</span>                                                          │</span><br><span class="line">│ unstable restarts │ <span class="number">0</span>                                                            │</span><br><span class="line">│ uptime            │ <span class="number">87</span>m                                                          │</span><br><span class="line">│ created at        │ <span class="number">2016</span><span class="literal">-08</span><span class="literal">-26T08</span>:<span class="number">13</span>:<span class="number">43.705</span>Z                                     │</span><br><span class="line">└───────────────────┴──────────────────────────────────────────────────────────────┘</span><br></pre></td></tr></table></figure><h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><h4 id="简单说明"><a href="#简单说明" class="headerlink" title="简单说明"></a>简单说明</h4><ul><li>配置文件里的设置项，跟命令行参数基本是一一对应的。</li><li>可以选择<code>yaml</code>或者<code>json</code>文件，就看个人洗好了。</li><li><code>json</code>格式的配置文件，pm2当作普通的js文件来处理，所以可以在里面添加注释或者编写代码，这对于动态调整配置很有好处。</li><li>如果启动的时候指定了配置文件，那么命令行参数会被忽略。（个别参数除外，比如–env）</li></ul><h4 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h4><p>举个简单例子，完整配置说明请参考<a target="_blank" rel="noopener" href="http://pm2.keymetrics.io/docs/usage/pm2-doc-single-page/">官方文档</a>。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>        : <span class="string">&quot;fis-receiver&quot;</span>,  <span class="comment">// 应用名称</span></span><br><span class="line">  <span class="string">&quot;script&quot;</span>      : <span class="string">&quot;./bin/www&quot;</span>,  <span class="comment">// 实际启动脚本</span></span><br><span class="line">  <span class="string">&quot;cwd&quot;</span>         : <span class="string">&quot;./&quot;</span>,  <span class="comment">// 当前工作路径</span></span><br><span class="line">  <span class="string">&quot;watch&quot;</span>: [  <span class="comment">// 监控变化的目录，一旦变化，自动重启</span></span><br><span class="line">    <span class="string">&quot;bin&quot;</span>,</span><br><span class="line">    <span class="string">&quot;routers&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;ignore_watch&quot;</span> : [  <span class="comment">// 从监控目录中排除</span></span><br><span class="line">    <span class="string">&quot;node_modules&quot;</span>, </span><br><span class="line">    <span class="string">&quot;logs&quot;</span>,</span><br><span class="line">    <span class="string">&quot;public&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;watch_options&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;followSymlinks&quot;</span>: <span class="literal">false</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;error_file&quot;</span> : <span class="string">&quot;./logs/app-err.log&quot;</span>,  <span class="comment">// 错误日志路径</span></span><br><span class="line">  <span class="string">&quot;out_file&quot;</span>   : <span class="string">&quot;./logs/app-out.log&quot;</span>,  <span class="comment">// 普通日志路径</span></span><br><span class="line">  <span class="string">&quot;log_date_format&quot;</span>: <span class="string">&quot;YYYY-MM-DD HH:mm:ss&quot;</span>, <span class="comment">// 时间戳</span></span><br><span class="line">  <span class="string">&quot;env&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;NODE_ENV&quot;</span>: <span class="string">&quot;production&quot;</span>  <span class="comment">// 环境参数，当前指定为生产环境</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;instances&quot;</span>: <span class="number">4</span>,   <span class="comment">// 4核处理器，对应四个进程</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>启动的时候设置package.json：<code>&quot;prd&quot;:&quot;cross-env NODE_ENV=production pm2 start pm2.conf.json&quot;</code></p><h3 id="自动重启"><a href="#自动重启" class="headerlink" title="自动重启"></a>自动重启</h3><p>前面已经提到了，这里贴命令行，更多点击<a target="_blank" rel="noopener" href="http://pm2.keymetrics.io/docs/usage/watch-and-restart/#auto-restart-apps-on-file-change">这里</a>。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 start app.js --watch</span><br></pre></td></tr></table></figure><p>这里是监控整个项目的文件，如果只想监听指定文件和目录，建议通过配置文件的<code>watch</code>、<code>ignore_watch</code>字段来设置</p><h3 id="环境切换"><a href="#环境切换" class="headerlink" title="环境切换"></a>环境切换</h3><blockquote><p>在实际项目开发中，我们的应用经常需要在多个环境下部署，比如开发环境、测试环境、生产环境等。在不同环境下，有时候配置项会有差异，比如链接的数据库地址不同等。</p><p>对于这种场景，pm2也是可以很好支持的。首先通过在配置文件中通过<code>env_xx</code>来声明不同环境的配置，然后在启动应用时，通过<code>--env</code>参数指定运行的环境。</p></blockquote><h4 id="环境配置声明"><a href="#环境配置声明" class="headerlink" title="环境配置声明"></a>环境配置声明</h4><p>首先，在配置文件中，通过<code>env</code>选项声明多个环境配置。简单说明下：</p><ul><li><code>env</code>为默认的环境配置（生产环境），<code>env_dev</code>、<code>env_test</code>则分别是开发、测试环境。可以看到，不同环境下的<code>NODE_ENV</code>、<code>REMOTE_ADDR</code>字段的值是不同的。</li><li>在应用中，可以通过<code>process.env.REMOTE_ADDR</code>等来读取配置中声明的变量。</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;env&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;NODE_ENV&quot;</span>: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">  <span class="string">&quot;REMOTE_ADDR&quot;</span>: <span class="string">&quot;http://www.example.com/&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;env_dev&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;NODE_ENV&quot;</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">  <span class="string">&quot;REMOTE_ADDR&quot;</span>: <span class="string">&quot;http://wdev.example.com/&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;env_test&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;NODE_ENV&quot;</span>: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">  <span class="string">&quot;REMOTE_ADDR&quot;</span>: <span class="string">&quot;http://wtest.example.com/&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="启动指明环境"><a href="#启动指明环境" class="headerlink" title="启动指明环境"></a>启动指明环境</h4><p>假设通过下面启动脚本（开发环境），那么，此时<code>process.env.REMOTE_ADDR</code>的值就是相应的 <a target="_blank" rel="noopener" href="http://wdev.example.com/">http://wdev.example.com/</a> ，可以自己试验下。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 <span class="built_in">start</span> app.js -<span class="literal">-env</span> dev</span><br></pre></td></tr></table></figure><h3 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h3><p>命令如下，表示开启三个进程。如果<code>-i 0</code>，则会根据机器当前核数自动开启尽可能多的进程。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pm2 <span class="built_in">start</span> app.js <span class="literal">-i</span> <span class="number">3</span> <span class="comment"># 开启三个进程</span></span><br><span class="line">pm2 <span class="built_in">start</span> app.js <span class="literal">-i</span> max <span class="comment"># 根据机器CPU核数，开启对应数目的进程 </span></span><br></pre></td></tr></table></figure><p><strong>服务进程数</strong></p><p>至于要启动几个进程，可以通过服务器的内核数进行确定，几个内核就启动几个服务。指令如下：</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看物理CPU个数</span></span><br><span class="line">cat /proc/cpuinfo<span class="params">| grep &quot;physical id&quot; |</span> sort<span class="params">| uniq |</span> wc -l</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看每个物理CPU中core的个数(即核数)</span></span><br><span class="line">cat /proc/cpuinfo<span class="params">| grep &quot;cpu cores&quot;|</span> uniq</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看逻辑CPU的个数</span></span><br><span class="line">cat /proc/cpuinfo<span class="params">| grep &quot;processor&quot;|</span> wc -l</span><br></pre></td></tr></table></figure><p>作者：狐尼克朱迪<br>链接：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/225b9284cfb8">https://www.jianshu.com/p/225b9284cfb8</a><br>来源：简书<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p><p>参考文档：<a target="_blank" rel="noopener" href="http://pm2.keymetrics.io/docs/usage/cluster-mode/#automatic-load-balancing">点击查看</a></p><h3 id="日志查看"><a href="#日志查看" class="headerlink" title="日志查看"></a>日志查看</h3><p>除了可以打开日志文件查看日志外，还可以通过<code>pm2 logs</code>来查看实时日志。这点对于线上问题排查非常重要。</p><p>比如某个node服务突然异常重启了，那么可以通过pm2提供的日志工具来查看实时日志，看是不是脚本出错之类导致的异常重启。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 logs</span><br></pre></td></tr></table></figure><h3 id="指令tab补全"><a href="#指令tab补全" class="headerlink" title="指令tab补全"></a>指令tab补全</h3><p>运行<code>pm2 --help</code>，可以看到<code>pm2</code>支持的子命令还是蛮多的，这个时候，自动完成的功能就很重要了。</p><p>运行如下命令。恭喜，已经能够通过tab自动补全了。细节可参考<a target="_blank" rel="noopener" href="http://pm2.keymetrics.io/docs/usage/auto-completion/">这里</a>。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pm2 completion install</span><br><span class="line">source ~&#x2F;.bash_profile</span><br></pre></td></tr></table></figure><h3 id="开机自动启动"><a href="#开机自动启动" class="headerlink" title="开机自动启动"></a>开机自动启动</h3><p>可以通过<code>pm2 startup</code>来实现开机自启动。细节可<a target="_blank" rel="noopener" href="http://pm2.keymetrics.io/docs/usage/startup/">参考</a>。大致流程如下</p><ol><li>通过<code>pm2 save</code>保存当前进程状态。</li><li>通过<code>pm2 startup [platform]</code>生成开机自启动的命令。（记得查看控制台输出）</li><li>将步骤2生成的命令，粘贴到控制台进行，搞定</li></ol><h3 id="监控-monitor"><a href="#监控-monitor" class="headerlink" title="监控(monitor)"></a>监控(monitor)</h3><p>运行如下命令，查看当前通过pm2运行的进程的状态。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 monit</span><br></pre></td></tr></table></figure><p>看到类似输出</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@oneday-dev0 server]# pm2 monit</span><br><span class="line">⌬ PM2 monitoring (To go further check out https:&#x2F;&#x2F;app.keymetrics.io) </span><br><span class="line">                                       [                              ] 0 %</span><br><span class="line">⌬ PM2 monitoring (To go further check o[|||||||||||||||               ] 196.285 MB  </span><br><span class="line"></span><br><span class="line"> ● fis-receiver                        [                              ] 0 %</span><br><span class="line">[1] [fork_mode]                        [|||||                         ] 65.773 MB  </span><br><span class="line"></span><br><span class="line"> ● www                                 [                              ] 0 %</span><br><span class="line">[2] [fork_mode]                        [|||||                         ] 74.426 MB  </span><br><span class="line"></span><br><span class="line"> ● oc-server                           [                              ] 0 %</span><br><span class="line">[3] [fork_mode]                        [||||                          ] 57.801 MB  </span><br><span class="line"></span><br><span class="line"> ● pm2-http-interface                  [                              ] stopped</span><br><span class="line">[4] [fork_mode]                        [                              ] 0 B   </span><br><span class="line"></span><br><span class="line"> ● start-production</span><br><span class="line">[5] [fork_mode]</span><br></pre></td></tr></table></figure><h3 id="内存使用超过上限自动重启"><a href="#内存使用超过上限自动重启" class="headerlink" title="内存使用超过上限自动重启"></a>内存使用超过上限自动重启</h3><p>如果想要你的应用，在超过使用内存上限后自动重启，那么可以加上<code>--max-memory-restart</code>参数。（有对应的配置项）</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 <span class="built_in">start</span> big<span class="literal">-array</span>.js -<span class="literal">-max</span><span class="literal">-memory</span><span class="literal">-restart</span> <span class="number">20</span>M</span><br></pre></td></tr></table></figure><h3 id="更新pm2"><a href="#更新pm2" class="headerlink" title="更新pm2"></a>更新pm2</h3><p>官方文档：<a target="_blank" rel="noopener" href="http://pm2.keymetrics.io/docs/usage/update-pm2/#updating-pm2">http://pm2.keymetrics.io/docs/usage/update-pm2/#updating-pm2</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ pm2 save # 记得保存进程状态</span><br><span class="line">$ npm install pm2 -g</span><br><span class="line">$ pm2 update</span><br></pre></td></tr></table></figure><h3 id="pm2-nginx"><a href="#pm2-nginx" class="headerlink" title="pm2 + nginx"></a>pm2 + nginx</h3><p>无非就是在nginx上做个反向代理配置，直接贴配置。</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">upstream</span> my_nodejs_upstream &#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">127.0.0.1:3001</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> my_nodejs_server;</span><br><span class="line">    <span class="attribute">root</span> /home/www/project_root;</span><br><span class="line">    </span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">    	<span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">    	<span class="attribute">proxy_set_header</span> Host <span class="variable">$http_host</span>;</span><br><span class="line">    	<span class="attribute">proxy_set_header</span> X-NginX-Proxy <span class="literal">true</span>;</span><br><span class="line">    	<span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">    	<span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">    	<span class="attribute">proxy_set_header</span> Connection <span class="string">&quot;upgrade&quot;</span>;</span><br><span class="line">    	<span class="attribute">proxy_max_temp_file_size</span> <span class="number">0</span>;</span><br><span class="line">    	<span class="attribute">proxy_pass</span> http://my_nodejs_upstream/;</span><br><span class="line">    	<span class="attribute">proxy_redirect</span> <span class="literal">off</span>;</span><br><span class="line">    	<span class="attribute">proxy_read_timeout</span> <span class="number">240s</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="nvm"><a href="#nvm" class="headerlink" title="nvm"></a>nvm</h2><ol><li>nvm,nodejs版本管理工具，可切换多个nodejs版本</li><li>mac os ,使用brew install nvm</li><li>windows， 在GitHub中搜索nvm-windows,有下载地址</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nvm list   <span class="comment">// 查已安装nodejs版本</span></span><br><span class="line">nvm install v10<span class="number">.15</span><span class="number">.0</span>    <span class="comment">//安装nodejs v10.15.0版本</span></span><br><span class="line">nvm use --<span class="keyword">delete</span>-prefix 版本号</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="redis"><a href="#redis" class="headerlink" title="redis"></a>redis</h2><ul><li>web server 最常用的缓存数据库，数据库放在内存中</li><li>相比于mysql,访问速度快（内存的速度要远远高于硬盘的）</li><li>但是成本高，可存储的数据量更小（内存的硬伤）</li></ul><p><img data-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200613170655276.png" alt="image-20200613170655276"></p><blockquote><p>这里的redis好比数据库，就是将session,单独的存储在这里，解决了进程频繁访问，数据量增多给进程带来的问题，同时也解决了，多进程的问题，所有的进程都可以访问redis中的session</p></blockquote><p><img data-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200613171409575.png" alt="image-20200613171409575"></p><p><img data-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200613171546347.png" alt="image-20200613171546347"></p><h3 id="使用："><a href="#使用：" class="headerlink" title="使用："></a>使用：</h3><ol><li><p>安装：<a target="_blank" rel="noopener" href="https://www.runoob.com/redis/redis-install.html">https://www.runoob.com/redis/redis-install.html</a></p></li><li><p>打开一个 <strong>cmd</strong> 窗口 使用 cd 命令切换目录到 <strong>C:\redis</strong> 运行：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-server.exe redis.windows.conf</span><br><span class="line">// 或者</span><br><span class="line">redis-server</span><br></pre></td></tr></table></figure></li><li><p>双击<code>redis-cli.exe</code></p></li><li><p>nodejs连接redis</p><ol><li>安装：<code>npm i redis</code></li><li>引入：<code>const redis = require(&#39;redis&#39;)</code></li><li>创建客户端：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> redisClient = redis.createClient(<span class="number">6379</span>, <span class="string">&#x27;127.0.0.1&#x27;</span>)</span><br><span class="line">redisClient.on(<span class="string">&#x27;error&#x27;</span>, <span class="function"><span class="params">err</span>=&gt;</span> &#123;</span><br><span class="line">	<span class="built_in">console</span>,log(err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ol start="4"><li>测试：</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加</span></span><br><span class="line">redisClient.set(<span class="string">&#x27;myname&#x27;</span>,<span class="string">&#x27;zhangsan&#x27;</span>,redis.print)  <span class="comment">//redis.print将添加的展示出来</span></span><br><span class="line">redisClient.get(<span class="string">&#x27;myname&#x27;</span>,(err, <span class="function"><span class="params">val</span> =&gt;</span> &#123;    <span class="comment">// val就是获取的值</span></span><br><span class="line">    <span class="keyword">if</span>(err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(err)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;val&#x27;</span>,val)</span><br><span class="line">    <span class="comment">//退出</span></span><br><span class="line">    redisClient.quit() </span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure></li></ol><ol start="5"><li><p>redis</p><p><code>npm i redis connect-redis --save</code></p><p>redis与session的连接</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入</span></span><br><span class="line"><span class="keyword">const</span> Sessions = <span class="built_in">require</span>(<span class="string">&#x27;express-session&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> RedisStore = <span class="built_in">require</span>(<span class="string">&#x27;connect-redis&#x27;</span>)(Sessions)</span><br><span class="line"><span class="comment">// 设置</span></span><br><span class="line"><span class="keyword">const</span> redisClient = <span class="built_in">require</span>(<span class="string">&#x27;./db/redis&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> sessionStore = <span class="keyword">new</span> RedisStore(&#123;</span><br><span class="line">    client: redisClient</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 与session连接</span></span><br><span class="line">app.use(Sessions(&#123; <span class="comment">// 设置session</span></span><br><span class="line">    secret: <span class="string">&#x27;XwW2037.&#x27;</span>, <span class="comment">// 相当于密钥</span></span><br><span class="line">    cookie: &#123;</span><br><span class="line">        path: <span class="string">&#x27;/&#x27;</span>, <span class="comment">// 根目录</span></span><br><span class="line">        httpOnly: <span class="literal">true</span>, <span class="comment">// 前端无法访问</span></span><br><span class="line">        maxAge: <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span> <span class="comment">// 失效时间</span></span><br><span class="line">    &#125;,</span><br><span class="line">    store: sessionStore   <span class="comment">// 连接</span></span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure></li></ol><h2 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h2><p>特点：占有内存少，并发能力强，他专为性能优化而开发。</p><ul><li>高性能的web服务器开源免费</li><li>一般用于做静态服务，负载均衡，动静分离</li><li>以及反向代理</li></ul><p><img data-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200614104017778.png" alt="image-20200614104017778"></p><ul><li>下载：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chen1005/p/10520812.html">https://www.cnblogs.com/chen1005/p/10520812.html</a></li></ul><h4 id="1-正向代理"><a href="#1-正向代理" class="headerlink" title="1.正向代理"></a>1.正向代理</h4><blockquote><p>在浏览器中配置代理服务器，通过代理服务器访问局域网外的internet.</p></blockquote><p><img data-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200817111232641.png" alt="image-20200817111232641"></p><h4 id="2-反向代理"><a href="#2-反向代理" class="headerlink" title="2.反向代理"></a>2.反向代理</h4><blockquote><p>我们只需要将请求发送到反向代理服务器，由反向代理服务器去选择目标服务器获取数据后，在返回给客户端，此时反向代理服务器和目标服务器对外就是一个服务器，暴露的是代理服务器地址，隐藏了真实服务器 IP 地址。</p></blockquote><p><img data-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200817112247843.png" alt="image-20200817112247843"></p><h4 id="3-负载均衡"><a href="#3-负载均衡" class="headerlink" title="3.负载均衡"></a>3.负载均衡</h4><blockquote><p>单个服务器解决不了多重并发访问，我们可以通过增加服务器的数量，然后将请求分发到多个服务器上，<strong>将原来的请求集中到单个服务器上的情况改为将请求分发到多个服务器上</strong>，将负载分发到不同的服务器，也就是我们所说的负载均衡。</p></blockquote><p><img data-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200817113612376.png" alt="image-20200817113612376"></p><h4 id="4-动静分离"><a href="#4-动静分离" class="headerlink" title="4.动静分离"></a>4.动静分离</h4><blockquote><p>为了加快网页的解析速度，可以把动态页面和静态页面由不同的服务器来解析，加快解析速度，降低原来单个服务器的压力。</p></blockquote><p><img data-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200817114558756.png" alt="image-20200817114558756"></p><ul><li>在 nginx.conf中做配置</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#user  nobody;</span><br><span class="line">worker_processes  4; &#x2F;&#x2F;本机处理器</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">        listen       8080;   &#x2F;&#x2F; 监听的服务器端口号</span><br><span class="line">        server_name  localhost;  &#x2F;&#x2F;服务器名称</span><br><span class="line">        &#x2F;&#x2F; 反向代理配置, 注意冒号问题</span><br><span class="line">        location &#x2F; &#123;</span><br><span class="line">	        proxy_pass http:&#x2F;&#x2F;localhost:8001;</span><br><span class="line">	    &#125;</span><br><span class="line">	    location &#x2F;api &#123;</span><br><span class="line">	       proxy_pass http:&#x2F;&#x2F;localhost:8000;</span><br><span class="line">	       proxy_set_header Host $host;</span><br><span class="line">	     &#125;</span><br></pre></td></tr></table></figure><ul><li>基本的命令</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// nginx命令：启动nginx</span><br><span class="line">C:/nginx-0.8.53&gt;nginx.exe  或者</span><br><span class="line">C:/nginx-0.8.53&gt;start nginx</span><br><span class="line"></span><br><span class="line">// nginx命令：停止nginx的命令主要有两种，即</span><br><span class="line">C:/nginx-0.8.53&gt;nginx -s stop  或者</span><br><span class="line">C:/nginx-0.8.53&gt;nginx -s quit</span><br><span class="line">// nginx停止命令stop与quit参数的区别在于stop是快速停止nginx，可能并不保存相关信息，quit是完整有序的停止nginx，并保存相关信息。</span><br><span class="line"></span><br><span class="line">// 重载nginx命令</span><br><span class="line">nginx -s reopen</span><br></pre></td></tr></table></figure><p><img data-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200606110014073.png" alt="image-20200606110014073"></p></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">----------文本结束<i class="fa fa-hand-o-right"></i>感谢您的阅读--------</div></div></div><div class="reward-container"><div>坚持原创，感谢您的支持！</div><button onclick='var qr=document.getElementById("qr");qr.style.display="none"===qr.style.display?"block":"none"'>打赏</button><div id="qr" style="display:none"><div style="display:inline-block"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/images/wechat.jpg" alt="John Doe 微信支付"><p>微信支付</p></div><div style="display:inline-block"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/images/zhifubao.jpg" alt="John Doe 支付宝"><p>支付宝</p></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/nodeJs/" rel="tag"><i class="fa fa-tag"></i> nodeJs</a></div><div class="post-nav"><div class="post-nav-item"><a href="/2020/09/10/6.jQuery/" rel="prev" title="js库之jQuery"><i class="fa fa-chevron-left"></i> js库之jQuery</a></div><div class="post-nav-item"><a href="/2020/09/10/3JS/" rel="next" title="javascript基础知识">javascript基础知识 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="valine-comments"></div><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#node-js"><span class="nav-number">1.</span> <span class="nav-text">node.js</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0"><span class="nav-number">1.1.</span> <span class="nav-text">概述</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-Node-js%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-number">1.1.1.</span> <span class="nav-text">1.Node.js是什么</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-Node-js%E4%B8%AD%E7%9A%84javascript"><span class="nav-number">1.1.2.</span> <span class="nav-text">2.Node.js中的javascript</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E6%A8%A1%E5%9D%97"><span class="nav-number">1.1.3.</span> <span class="nav-text">3.模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-http%E5%8D%8F%E8%AE%AE"><span class="nav-number">1.1.4.</span> <span class="nav-text">4.http协议</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-ip%E5%9C%B0%E5%9D%80%E5%92%8C%E7%AB%AF%E5%8F%A3%E5%8F%B7"><span class="nav-number">1.1.5.</span> <span class="nav-text">5.ip地址和端口号</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%BB%91%E7%9B%92%E5%AD%90"><span class="nav-number">1.1.6.</span> <span class="nav-text">6.服务器黑盒子</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A8%A1%E5%9D%97%E5%8C%96"><span class="nav-number">1.2.</span> <span class="nav-text">模块化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E4%BB%80%E4%B9%88%E6%98%AF%E6%A8%A1%E5%9D%97%E5%8C%96"><span class="nav-number">1.2.1.</span> <span class="nav-text">1.什么是模块化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%A8%A1%E5%9D%97%E5%8C%96%E7%9B%B8%E5%85%B3%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="nav-number">1.2.2.</span> <span class="nav-text">2.模块化相关的概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-Node-%E4%B8%AD%E6%A8%A1%E5%9D%97%E7%9A%84-3-%E4%B8%AA%E5%A4%A7%E7%B1%BB"><span class="nav-number">1.2.3.</span> <span class="nav-text">3.Node 中模块的 3 个大类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E4%BD%BF%E7%94%A8-require-%E6%96%B9%E6%B3%95%E5%8A%A0%E8%BD%BD%E6%A8%A1%E5%9D%97"><span class="nav-number">1.2.4.</span> <span class="nav-text">4.使用 require 方法加载模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-exports%E6%8E%A5%E5%8F%A3%E5%AF%BC%E5%87%BA%E6%A8%A1%E5%9D%97"><span class="nav-number">1.2.5.</span> <span class="nav-text">5.exports接口导出模块</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HTTP%E5%8D%8F%E8%AE%AE"><span class="nav-number">1.3.</span> <span class="nav-text">HTTP协议</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="nav-number">1.3.1.</span> <span class="nav-text">1.基本使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84%E9%87%8D%E5%AE%9A%E5%90%91"><span class="nav-number">1.3.2.</span> <span class="nav-text">2.客户端的重定向</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E6%B5%8F%E8%A7%88%E5%99%A8%E8%A7%A3%E6%9E%90%E9%97%AE%E9%A2%98"><span class="nav-number">1.3.3.</span> <span class="nav-text">3.浏览器解析问题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#URL%E6%A8%A1%E5%9D%97"><span class="nav-number">1.4.</span> <span class="nav-text">URL模块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%9F%BA%E7%A1%80"><span class="nav-number">1.4.1.</span> <span class="nav-text">1.基础</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AA%E8%B7%AF%E7%94%B1router"><span class="nav-number">1.4.2.</span> <span class="nav-text">2.编写一个路由router</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#node%E4%B8%AD%E7%9A%84%E6%A8%A1%E6%9D%BF"><span class="nav-number">1.5.</span> <span class="nav-text">node中的模板</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E4%BD%BF%E7%94%A8"><span class="nav-number">1.5.1.</span> <span class="nav-text">1.使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-data%E5%80%BC%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">1.5.2.</span> <span class="nav-text">2.data值的使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-each%E7%9A%84%E8%BE%A8%E5%88%AB"><span class="nav-number">1.5.3.</span> <span class="nav-text">3.each的辨别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E6%B8%B2%E6%9F%93"><span class="nav-number">1.5.4.</span> <span class="nav-text">4.渲染</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E5%85%B6%E4%BB%96%E6%A8%A1%E6%9D%BF"><span class="nav-number">1.5.5.</span> <span class="nav-text">5.其他模板</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#fs%E6%A8%A1%E5%9D%97"><span class="nav-number">1.6.</span> <span class="nav-text">fs模块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%96%87%E4%BB%B6%E5%A4%B9%E6%93%8D%E4%BD%9C"><span class="nav-number">1.6.1.</span> <span class="nav-text">1.文件夹操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C"><span class="nav-number">1.6.2.</span> <span class="nav-text">2.文件操作</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E6%A8%A1%E5%9D%97"><span class="nav-number">1.7.</span> <span class="nav-text">其他模块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-os%E6%A8%A1%E5%9D%97"><span class="nav-number">1.7.1.</span> <span class="nav-text">1.os模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-path%E6%A8%A1%E5%9D%97"><span class="nav-number">1.7.2.</span> <span class="nav-text">2.path模块</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A8%A1%E5%9D%97"><span class="nav-number">1.8.</span> <span class="nav-text">第三方模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Express%E6%A1%86%E6%9E%B6"><span class="nav-number">1.9.</span> <span class="nav-text">Express框架</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%AE%89%E8%A3%85%EF%BC%9A"><span class="nav-number">1.9.1.</span> <span class="nav-text">1.安装：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-hello-worrd"><span class="nav-number">1.9.2.</span> <span class="nav-text">2.hello worrd</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%9F%BA%E6%9C%AC%E8%B7%AF%E7%94%B1"><span class="nav-number">1.9.3.</span> <span class="nav-text">3.基本路由</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E9%9D%99%E6%80%81%E6%9C%8D%E5%8A%A1"><span class="nav-number">1.9.4.</span> <span class="nav-text">4.静态服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E4%BD%BF%E7%94%A8%E6%88%90%E5%99%A8%E5%B7%A5%E5%85%B7-express-generator%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%BA%94%E7%94%A8%E7%9A%84%E9%AA%A8%E6%9E%B6"><span class="nav-number">1.9.5.</span> <span class="nav-text">5.使用成器工具 express-generator创建一个应用的骨架</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-expepress%E4%B8%AD%E4%BD%BF%E7%94%A8art-template"><span class="nav-number">1.9.6.</span> <span class="nav-text">6.expepress中使用art-template</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-%E8%8E%B7%E5%8F%96%E8%A1%A8%E5%8D%95%E8%AF%B7%E6%B1%82%E4%BD%93%E6%95%B0%E6%8D%AE"><span class="nav-number">1.9.7.</span> <span class="nav-text">7.获取表单请求体数据</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%9C%A8Express%E8%8E%B7%E5%8F%96%E8%A1%A8%E5%8D%95GET%E8%AF%B7%E6%B1%82%E4%BD%93%E6%95%B0%E6%8D%AE"><span class="nav-number">1.9.7.1.</span> <span class="nav-text">1.在Express获取表单GET请求体数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%9C%A8Express%E8%8E%B7%E5%8F%96%E8%A1%A8%E5%8D%95POST%E8%AF%B7%E6%B1%82%E4%BD%93%E6%95%B0%E6%8D%AE"><span class="nav-number">1.9.7.2.</span> <span class="nav-text">2.在Express获取表单POST请求体数据</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-path%E8%B7%AF%E5%BE%84%E7%BB%9D%E5%AF%B9%E5%8C%96"><span class="nav-number">1.9.8.</span> <span class="nav-text">8.path路径绝对化</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Express%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="nav-number">1.10.</span> <span class="nav-text">Express中间件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%BA%A7%E5%88%AB%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="nav-number">1.10.1.</span> <span class="nav-text">1.应用程序级别中间件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E8%B7%AF%E7%94%B1%E7%BA%A7%E5%88%AB%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="nav-number">1.10.2.</span> <span class="nav-text">2.路由级别中间件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="nav-number">1.10.3.</span> <span class="nav-text">3.错误处理中间件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E7%AC%AC%E4%B8%89%E6%96%B9%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="nav-number">1.10.4.</span> <span class="nav-text">4.第三方中间件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#node%E4%B8%AD%E7%9A%84%E9%9D%9E%E6%A8%A1%E5%9D%97%E6%88%90%E5%91%98"><span class="nav-number">1.11.</span> <span class="nav-text">node中的非模块成员</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#koa2"><span class="nav-number">1.12.</span> <span class="nav-text">koa2</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%90%AD%E5%BB%BA%E7%8E%AF%E5%A2%83"><span class="nav-number">1.12.1.</span> <span class="nav-text">1.搭建环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-HelloKoa2"><span class="nav-number">1.12.2.</span> <span class="nav-text">2.HelloKoa2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="nav-number">1.12.3.</span> <span class="nav-text">中间件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-get%E8%AF%B7%E6%B1%82"><span class="nav-number">1.12.4.</span> <span class="nav-text">3.get请求</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#query%E5%92%8Cquerystring%E5%8C%BA%E5%88%AB"><span class="nav-number">1.12.4.1.</span> <span class="nav-text">query和querystring区别</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%B4%E6%8E%A5%E4%BB%8Ectx%E4%B8%AD%E8%8E%B7%E5%8F%96GET%E8%AF%B7%E6%B1%82"><span class="nav-number">1.12.4.2.</span> <span class="nav-text">直接从ctx中获取GET请求</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-post%E8%AF%B7%E6%B1%82"><span class="nav-number">1.12.5.</span> <span class="nav-text">4.post请求</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96Post%E8%AF%B7%E6%B1%82%E7%9A%84%E6%AD%A5%E9%AA%A4%EF%BC%9A"><span class="nav-number">1.12.5.1.</span> <span class="nav-text">获取Post请求的步骤：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-koa-router"><span class="nav-number">1.12.6.</span> <span class="nav-text">5.koa-router</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-koa-cookie"><span class="nav-number">1.12.7.</span> <span class="nav-text">6.koa-cookie</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-koa-session"><span class="nav-number">1.12.8.</span> <span class="nav-text">7.koa-session</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-koa%E6%A8%A1%E6%9D%BF%E5%88%9D%E5%A7%8B%EF%BC%88ejs%EF%BC%89"><span class="nav-number">1.12.9.</span> <span class="nav-text">8.koa模板初始（ejs）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-koa-static%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="nav-number">1.12.10.</span> <span class="nav-text">9.koa-static静态资源中间件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-koa-bodyparser"><span class="nav-number">1.12.11.</span> <span class="nav-text">10.koa-bodyparser</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%9F%E8%AF%8D%E8%A1%A8"><span class="nav-number">1.12.12.</span> <span class="nav-text">生词表</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Session%E5%92%8CCookie"><span class="nav-number">1.13.</span> <span class="nav-text">Session和Cookie</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Session"><span class="nav-number">1.13.1.</span> <span class="nav-text">Session</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cookie"><span class="nav-number">1.13.2.</span> <span class="nav-text">cookie</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#dirname-%E5%92%8C-filename"><span class="nav-number">1.14.</span> <span class="nav-text">__dirname 和 __filename</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#node%E4%B8%AD%E7%9A%84%E6%97%A5%E5%BF%97"><span class="nav-number">1.15.</span> <span class="nav-text">node中的日志</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%A6%82%E5%BF%B5"><span class="nav-number">1.15.1.</span> <span class="nav-text">1.概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%97%A5%E5%BF%97%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.15.2.</span> <span class="nav-text">2.日志的类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E6%97%A5%E5%BF%97%E4%B8%8E%E6%B5%81%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">1.15.3.</span> <span class="nav-text">3.日志与流的使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E6%97%A5%E5%BF%97%E6%8B%86%E5%88%86"><span class="nav-number">1.15.4.</span> <span class="nav-text">4.日志拆分</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90"><span class="nav-number">1.15.5.</span> <span class="nav-text">5.日志分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E6%8F%92%E4%BB%B6morgan"><span class="nav-number">1.15.6.</span> <span class="nav-text">6.插件morgan</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%EF%BC%9A"><span class="nav-number">1.15.6.1.</span> <span class="nav-text">安装：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%EF%BC%9A"><span class="nav-number">1.15.6.2.</span> <span class="nav-text">参数：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#format-%EF%BC%88string-function%EF%BC%89%E6%89%93%E5%8D%B0%E6%96%B9%E5%BC%8F%EF%BC%8C%E5%8F%AF%E4%BB%A5%E6%98%AF%E9%A2%84%E5%AE%9A%E4%B9%89%E6%89%93%E5%8D%B0%E6%96%B9%E5%BC%8F%E7%9A%84%E5%90%8D%E7%A7%B0%EF%BC%8C%E6%88%96%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%8C%E6%88%96%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%85%A5%E5%8F%A3%E7%9A%84%E5%9B%9E%E8%B0%83%E6%96%B9%E6%B3%95"><span class="nav-number">1.15.6.3.</span> <span class="nav-text">format:（string&#x2F;function）打印方式，可以是预定义打印方式的名称，或格式化字符串，或格式化入口的回调方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#options%EF%BC%9A%EF%BC%88object%EF%BC%89%E6%97%A5%E5%BF%97%E6%89%93%E5%8D%B0%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE"><span class="nav-number">1.15.6.4.</span> <span class="nav-text">options：（object）日志打印参数配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%84%E5%AE%9A%E4%B9%89%E6%A0%BC%E5%BC%8F"><span class="nav-number">1.15.6.5.</span> <span class="nav-text">预定义格式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E9%A1%B9"><span class="nav-number">1.15.6.6.</span> <span class="nav-text">设置项</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#node%E6%B5%81%EF%BC%88stream%EF%BC%89"><span class="nav-number">1.16.</span> <span class="nav-text">node流（stream）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E5%85%A8"><span class="nav-number">1.17.</span> <span class="nav-text">安全</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PM2"><span class="nav-number">1.18.</span> <span class="nav-text">PM2</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%EF%BC%9A-1"><span class="nav-number">1.18.1.</span> <span class="nav-text">安装：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%EF%BC%9A"><span class="nav-number">1.18.2.</span> <span class="nav-text">常用命令：</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8"><span class="nav-number">1.18.2.0.1.</span> <span class="nav-text">启动</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%87%8D%E5%90%AF"><span class="nav-number">1.18.2.0.2.</span> <span class="nav-text">重启</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%81%9C%E6%AD%A2"><span class="nav-number">1.18.2.0.3.</span> <span class="nav-text">停止</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%A0%E9%99%A4"><span class="nav-number">1.18.2.0.4.</span> <span class="nav-text">删除</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E8%BF%9B%E7%A8%8B%E7%8A%B6%E6%80%81"><span class="nav-number">1.18.2.0.5.</span> <span class="nav-text">查看进程状态</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%9F%90%E4%B8%AA%E8%BF%9B%E7%A8%8B%E7%9A%84%E4%BF%A1%E6%81%AF"><span class="nav-number">1.18.2.0.6.</span> <span class="nav-text">查看某个进程的信息</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">1.18.3.</span> <span class="nav-text">配置文件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E8%AF%B4%E6%98%8E"><span class="nav-number">1.18.3.1.</span> <span class="nav-text">简单说明</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BE%8B%E5%AD%90"><span class="nav-number">1.18.3.2.</span> <span class="nav-text">例子</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E9%87%8D%E5%90%AF"><span class="nav-number">1.18.4.</span> <span class="nav-text">自动重启</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E5%88%87%E6%8D%A2"><span class="nav-number">1.18.5.</span> <span class="nav-text">环境切换</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E5%A3%B0%E6%98%8E"><span class="nav-number">1.18.5.1.</span> <span class="nav-text">环境配置声明</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E6%8C%87%E6%98%8E%E7%8E%AF%E5%A2%83"><span class="nav-number">1.18.5.2.</span> <span class="nav-text">启动指明环境</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="nav-number">1.18.6.</span> <span class="nav-text">负载均衡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A5%E5%BF%97%E6%9F%A5%E7%9C%8B"><span class="nav-number">1.18.7.</span> <span class="nav-text">日志查看</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%87%E4%BB%A4tab%E8%A1%A5%E5%85%A8"><span class="nav-number">1.18.8.</span> <span class="nav-text">指令tab补全</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%80%E6%9C%BA%E8%87%AA%E5%8A%A8%E5%90%AF%E5%8A%A8"><span class="nav-number">1.18.9.</span> <span class="nav-text">开机自动启动</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%91%E6%8E%A7-monitor"><span class="nav-number">1.18.10.</span> <span class="nav-text">监控(monitor)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E5%AD%98%E4%BD%BF%E7%94%A8%E8%B6%85%E8%BF%87%E4%B8%8A%E9%99%90%E8%87%AA%E5%8A%A8%E9%87%8D%E5%90%AF"><span class="nav-number">1.18.11.</span> <span class="nav-text">内存使用超过上限自动重启</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0pm2"><span class="nav-number">1.18.12.</span> <span class="nav-text">更新pm2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pm2-nginx"><span class="nav-number">1.18.13.</span> <span class="nav-text">pm2 + nginx</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#nvm"><span class="nav-number">1.19.</span> <span class="nav-text">nvm</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#redis"><span class="nav-number">1.20.</span> <span class="nav-text">redis</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%EF%BC%9A"><span class="nav-number">1.20.1.</span> <span class="nav-text">使用：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#nginx"><span class="nav-number">1.21.</span> <span class="nav-text">nginx</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E6%AD%A3%E5%90%91%E4%BB%A3%E7%90%86"><span class="nav-number">1.21.0.1.</span> <span class="nav-text">1.正向代理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"><span class="nav-number">1.21.0.2.</span> <span class="nav-text">2.反向代理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="nav-number">1.21.0.3.</span> <span class="nav-text">3.负载均衡</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB"><span class="nav-number">1.21.0.4.</span> <span class="nav-text">4.动静分离</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="John Doe" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=3684345252,2646729991&fm=26&gp=0.jpg"><p class="site-author-name" itemprop="name">John Doe</p><div class="site-description" itemprop="description"></div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">11</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">9</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">11</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/1738736002" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;1738736002" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a> </span><span class="links-of-author-item"><a href="mailto:1738736002@qq.com" title="E-Mail → mailto:1738736002@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a> </span><span class="links-of-author-item"><a href="https://weibo.com/u/5752159618/home?wvr=5" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;5752159618&#x2F;home?wvr&#x3D;5" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i></a></span></div><div class="links-of-blogroll motion-element"><div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i> 友情链接</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="http://yoursite.com/" title="http:&#x2F;&#x2F;yoursite.com" rel="noopener" target="_blank">Title</a></li></ul></div></div><div class="back-to-top motion-element"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-history fa-" aria-hidden="true"></i> 近期文章</div><ul class="links-of-blogroll-list"><li class="recent_posts_li"><a href="/" target="_blank"></a></li><li class="recent_posts_li"><a href="/" target="_blank"></a></li><li class="recent_posts_li"><a href="/" target="_blank"></a></li><li class="recent_posts_li"><a href="/" target="_blank"></a></li><li class="recent_posts_li"><a href="/" target="_blank"></a></li></ul></div><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=1383403530&auto=1&height=66"></iframe></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2020</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">John Doe</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-chart-area"></i> </span><span class="post-meta-item-text">站点总字数：</span> <span title="站点总字数">293k</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span class="post-meta-item-text">站点阅读时长 &asymp;</span> <span title="站点阅读时长">4:26</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i> </span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span> </span></span><span class="post-meta-divider">|</span> <span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer></div><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><script>NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : true,
      appId      : 'HhBmsqkNlfQB4gpLpmFYUDxv-gzGzoHsz',
      appKey     : '7j1MdMn5bsljKv5N792nVH5h',
      placeholder: "留言区",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/assets/shizuku.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true}});</script><script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(n){n.imageLazyLoadSetting.processImages=o;var i=n.imageLazyLoadSetting.isSPA,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){i&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,e,a=0;a<r.length;a++)t=r[a],e=void 0,0<=(e=t.getBoundingClientRect()).bottom&&0<=e.left&&e.top<=(n.innerHeight||document.documentElement.clientHeight)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},n.src=i}()}o(),n.addEventListener("scroll",function(){var t,e;t=o,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script></body></html>